

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar_round.png">
  <link rel="icon" href="/img/avatar_round.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Taoran">
  <meta name="keywords" content="">
  
    <meta name="description" content="线性基这里指它的典型应用。 我没怎么学明白，原理没搞懂，只会写。汪老师说，线性基很特殊，它的原理和实现完全不一样。 线性基对于线性基所表示的所有数的集合 $S$，$S$ 中任意多个数异或所得的结果均能表示为线性基中的元素互相异或的结果。线性基能使用异或运算来表示原数集使用异或运算能表示的所有数。它可以完成以下操作：  ins(x) 插入 $x$； chk(x) 查询x能否被S中的数异或得到； q">
<meta property="og:type" content="article">
<meta property="og:title" content="刷题记录 24-08-19 至 24-09-10">
<meta property="og:url" content="https://algo-x.cn/articles/Problem-Solving-Summary-Aug19-Sep10/index.html">
<meta property="og:site_name" content="Algo-X.cn">
<meta property="og:description" content="线性基这里指它的典型应用。 我没怎么学明白，原理没搞懂，只会写。汪老师说，线性基很特殊，它的原理和实现完全不一样。 线性基对于线性基所表示的所有数的集合 $S$，$S$ 中任意多个数异或所得的结果均能表示为线性基中的元素互相异或的结果。线性基能使用异或运算来表示原数集使用异或运算能表示的所有数。它可以完成以下操作：  ins(x) 插入 $x$； chk(x) 查询x能否被S中的数异或得到； q">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-09-13T10:14:57.000Z">
<meta property="article:modified_time" content="2024-09-16T03:23:51.549Z">
<meta property="article:author" content="Taoran">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>刷题记录 24-08-19 至 24-09-10 - Algo-X.cn</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"algo-x.cn","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":75,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"#"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Algo-X.cn</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/articles/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>文章</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/errata/" target="_self">
                <i class="iconfont icon-bug"></i>
                <span>勘误表</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/chemistry/" target="_self">
                <i class="iconfont icon-exp-fill"></i>
                <span>化学</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/background.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="刷题记录 24-08-19 至 24-09-10"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-09-13 18:14" pubdate>
          2024年9月13日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          12k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          102 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">刷题记录 24-08-19 至 24-09-10</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    本文最后更新于 2024年9月16日 上午
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <hr>
<h3 id="线性基"><a href="#线性基" class="headerlink" title="线性基"></a>线性基</h3><p>这里指它的典型应用。</p>
<p>我没怎么学明白，原理没搞懂，只会写。<br>汪老师说，线性基很特殊，它的原理和实现完全不一样。</p>
<h4 id="线性基-1"><a href="#线性基-1" class="headerlink" title="线性基"></a>线性基</h4><p>对于线性基所表示的所有数的集合 $S$，$S$ 中任意多个数异或所得的结果均能表示为线性基中的元素互相异或的结果。线性基能使用异或运算来表示原数集使用异或运算能表示的所有数。它可以完成以下操作：</p>
<ol>
<li><code>ins(x)</code> 插入 $x$；</li>
<li><code>chk(x)</code> 查询x能否被S中的数异或得到；</li>
<li><code>qmax()</code> 查询S中若干数异或起来的最大值；</li>
<li><code>qmin()</code> 查询S中若干数异或起来的最小值；</li>
<li><code>query(k)</code> 查询S中若干数异或起来第k小的值。</li>
</ol>
<p>上述操作可以在 $O(\log^2V)$ 的时间复杂度内完成。</p>
<p>可以参考<a target="_blank" rel="noopener" href="https://oi-wiki.org/math/linear-algebra/basis/">OI-Wiki</a>和<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/xbfpsb9i">模板题解</a>学习它的原理。</p>
<h4 id="T1-线性基模板题"><a href="#T1-线性基模板题" class="headerlink" title="T1 线性基模板题"></a>T1 线性基模板题</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3812">洛谷P3812</a> 线性基</p>
<p>给出 $n$ 个数，求在这些数中选取任意个，使它们的异或和最大。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173525136">AC</a> 564.00KB 25ms</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> V 63 <span class="hljs-comment">// log(range)</span></span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ull;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Basis</span> &#123;<br>	ull a[V+<span class="hljs-number">1</span>], tmp[V+<span class="hljs-number">1</span>]; <span class="hljs-type">bool</span> zf; <span class="hljs-comment">// Zero Flag</span><br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ins</span><span class="hljs-params">(ull x)</span> </span>&#123; <span class="hljs-comment">// Insert</span><br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=V; ~i; --i) <span class="hljs-keyword">if</span> (x&amp;<span class="hljs-number">1ULL</span>&lt;&lt;i) &#123;<br>			<span class="hljs-keyword">if</span> (!a[i]) <span class="hljs-keyword">return</span> a[i]=x, <span class="hljs-built_in">void</span>();<br>			<span class="hljs-keyword">else</span> x^=a[i];<br>		&#125;<br>		zf=<span class="hljs-literal">true</span>;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">chk</span><span class="hljs-params">(ull x)</span> </span>&#123; <span class="hljs-comment">// Check Exist</span><br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=V; ~i; --i) <span class="hljs-keyword">if</span> (x&amp;<span class="hljs-number">1ULL</span>&lt;&lt;i) &#123;<br>			<span class="hljs-keyword">if</span> (!a[i]) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>			x^=a[i];<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>	&#125;<br>	<span class="hljs-function">ull <span class="hljs-title">qmax</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">// Query Max</span><br>		ull res=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=V; ~i; --i) res=<span class="hljs-built_in">max</span>(res, res^a[i]);<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>	<span class="hljs-function">ull <span class="hljs-title">qmin</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">// Query Min</span><br>		<span class="hljs-keyword">if</span> (zf) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;=V; ++i) <span class="hljs-keyword">if</span> (a[i]) <span class="hljs-keyword">return</span> a[i];<br>	&#125;<br>	<span class="hljs-function">ull <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> k)</span> </span>&#123; <span class="hljs-comment">// Query the kth Smaller</span><br>		ull res=<span class="hljs-number">0</span>; <span class="hljs-type">int</span> cnt=<span class="hljs-number">0</span>;<br>		k-=zf; <span class="hljs-keyword">if</span> (!k) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;=V; ++i) &#123;<br>			<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=i<span class="hljs-number">-1</span>; ~j; --j) <span class="hljs-keyword">if</span> (a[i]&amp;(<span class="hljs-number">1ULL</span>&lt;&lt;j)) a[i]^=a[j];<br>			<span class="hljs-keyword">if</span> (a[i]) tmp[cnt++]=a[i];<br>		&#125;<br>		<span class="hljs-keyword">if</span> (k&gt;=(<span class="hljs-number">1ULL</span>&lt;&lt;cnt)) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;cnt; ++i) <span class="hljs-keyword">if</span> (k&amp;<span class="hljs-number">1ULL</span>&lt;&lt;i) res^=tmp[i];<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>&#125;;<br><br><span class="hljs-type">int</span> n; ull t1;<br>Basis b;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;b.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) &#123;<br>		t1=<span class="hljs-built_in">read</span>();<br>		b.<span class="hljs-built_in">ins</span>(t1);<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%llu&quot;</span>, b.<span class="hljs-built_in">qmax</span>());<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="前缀线性基"><a href="#前缀线性基" class="headerlink" title="前缀线性基"></a>前缀线性基</h4><p>使用 <code>pos[i]</code> 表示线性基的第 $i$ 个数受影响的数的最小编号，即 <code>pos[i]</code> 之后线性基 <code>a[i]</code> 才有效。贪心思想，使 <code>pos[i]</code> 尽可能大。每次插入一个新的数，都更新一遍 <code>pos[i]</code>。</p>
<ol>
<li>ins(x) 插入x；</li>
<li>chk(x, l) 查询l之后x是否能被S中的数异或得到；</li>
<li>qmax(l) 查询l之后S中若干数异或起来的最大值。</li>
</ol>
<p>查询区间[l,r]异或最大值，可以使用a[r].qmax(l)得到。</p>
<p>可以参考<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/lc33siuq">这篇题解</a>理解。</p>
<h4 id="T2-前缀线性基模板题"><a href="#T2-前缀线性基模板题" class="headerlink" title="T2 前缀线性基模板题"></a>T2 前缀线性基模板题</h4><p><a target="_blank" rel="noopener" href="https://codeforces.com/problemset/problem/1100/F">CF1100F</a> Ivan and Burgers | <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF1100F">洛谷</a></p>
<p>给定长度为 $n$ 的序列和 $q$ 次询问，求从 $a_l,\ a_{l+1},\ \dots,\ a_r$ 中选若干个数，异或和最大为多少。</p>
<p><a target="_blank" rel="noopener" href="https://codeforces.com/contest/1100/submission/277118149">AC</a> 180.66MB 530ms</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> V 30 <span class="hljs-comment">// log(range)</span></span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ull;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">PrefixLinerBasis</span> &#123;<br>	ull a[V+<span class="hljs-number">1</span>]; <span class="hljs-type">int</span> pos[V+<span class="hljs-number">1</span>]; <span class="hljs-type">bool</span> zf; <span class="hljs-comment">// Zero Flag</span><br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ins</span><span class="hljs-params">(ull x, <span class="hljs-type">int</span> p)</span> </span>&#123; <span class="hljs-comment">// Insert(val, pos)</span><br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=V; ~i; --i) <span class="hljs-keyword">if</span> (x&amp;<span class="hljs-number">1ULL</span>&lt;&lt;i) &#123;<br>			<span class="hljs-keyword">if</span> (!a[i]) <span class="hljs-keyword">return</span> a[i]=x, pos[i]=p, <span class="hljs-built_in">void</span>();<br>			<span class="hljs-keyword">if</span> (pos[i]&lt;p) <span class="hljs-built_in">swap</span>(pos[i], p), <span class="hljs-built_in">swap</span>(a[i], x);<br>			x^=a[i];<br>		&#125;<br>		zf=<span class="hljs-literal">true</span>;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">chk</span><span class="hljs-params">(ull x, <span class="hljs-type">int</span> l)</span> </span>&#123; <span class="hljs-comment">// Check Exist ( &quot;pos&quot; in Range [l, +INF) )</span><br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=V; ~i; --i) <span class="hljs-keyword">if</span> (x&amp;<span class="hljs-number">1ULL</span>&lt;&lt;i) &#123;<br>			<span class="hljs-keyword">if</span> (!a[i]||pos[i]&lt;l) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>			x^=a[i];<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>	&#125;<br>	<span class="hljs-function">ull <span class="hljs-title">qmax</span><span class="hljs-params">(<span class="hljs-type">int</span> l)</span> </span>&#123; <span class="hljs-comment">// Query Max ( &quot;pos&quot; in Range [l, +INF) )</span><br>		ull res=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=V; ~i; --i) &#123;<br>			<span class="hljs-keyword">if</span> (pos[i]&lt;l) <span class="hljs-keyword">continue</span>;<br>			res=<span class="hljs-built_in">max</span>(res, res^a[i]);<br>		&#125;<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>	<span class="hljs-function">ull <span class="hljs-title">qmin</span><span class="hljs-params">(<span class="hljs-type">int</span> l)</span> </span>&#123; <span class="hljs-comment">// Query Min ( &quot;pos&quot; in Range [l, +INF) )</span><br>		<span class="hljs-keyword">if</span> (zf) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;=V; ++i) &#123;<br>			<span class="hljs-keyword">if</span> (pos[i]&lt;l) <span class="hljs-keyword">continue</span>;<br>			<span class="hljs-keyword">if</span> (a[i]) <span class="hljs-keyword">return</span> a[i];<br>		&#125;<br>	&#125;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 500010</span><br><span class="hljs-type">int</span> n; ull t1;<br><span class="hljs-type">int</span> q, l, r;<br>PrefixLinerBasis a[N];<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;c.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) t1=<span class="hljs-built_in">read</span>(), a[i]=a[i<span class="hljs-number">-1</span>], a[i].<span class="hljs-built_in">ins</span>(t1, i); <span class="hljs-comment">// Prefix</span><br>	q=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">while</span> (q--) &#123;<br>		l=<span class="hljs-built_in">read</span>(), r=<span class="hljs-built_in">read</span>();<br>		<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%llu\n&quot;</span>, a[r].<span class="hljs-built_in">qmax</span>(l));<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>可以参考<a target="_blank" rel="noopener" href="https://codeforces.com/contest/1100/submission/205951223">汪老师的代码</a>，会简洁得多。</p>
<h4 id="T3-线段树套线性基-单点修区间查"><a href="#T3-线段树套线性基-单点修区间查" class="headerlink" title="T3 线段树套线性基 单点修区间查"></a>T3 线段树套线性基 单点修区间查</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4839">洛谷P4839</a> P 哥的桶</p>
<p>线段树套线性基：对于每个节点维护一个线性基，表示区间 $[l,r]$ 内的信息。</p>
<p>插入：找到表示 $k$ 的点，在线性基中插入 $x$。<br>子树信息合并：将两个子树的线性基合并到根节点的线性基上。<br>区间查询：找到对应的子区间，合并即可。</p>
<p>注：代码中的 <code>LinerBasis operator+</code> 表示的是线性基的合并。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/174004934">AC</a> 50.05MB 6.97s</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> V 50</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ull;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LinerBasis</span> &#123;<br>	ull a[V+<span class="hljs-number">1</span>];<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-built_in">memset</span>(a, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(a));&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ins</span><span class="hljs-params">(ull x)</span> </span>&#123;<br>		<span class="hljs-keyword">for</span> (ll i=V; ~i; --i) <span class="hljs-keyword">if</span> (x&amp;<span class="hljs-number">1ULL</span>&lt;&lt;i) &#123;<br>			<span class="hljs-keyword">if</span> (!a[i]) <span class="hljs-keyword">return</span> a[i]=x, <span class="hljs-built_in">void</span>();<br>			x^=a[i];<br>		&#125;<br>	&#125;<br>	<span class="hljs-function">ull <span class="hljs-title">qmax</span><span class="hljs-params">()</span> </span>&#123;<br>		ull res=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span> (ll i=V; ~i; --i) res=<span class="hljs-built_in">max</span>(res, res^a[i]);<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>&#125;;<br><br>LinerBasis <span class="hljs-keyword">operator</span>+(LinerBasis a, LinerBasis b) &#123;<br>	<span class="hljs-keyword">for</span> (ll i=V; ~i; --i) <span class="hljs-keyword">if</span> (b.a[i]) a.<span class="hljs-built_in">ins</span>(b.a[i]);<br>	<span class="hljs-keyword">return</span> a;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 50010</span><br>ll n;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">struct</span> <span class="hljs-title class_">seg</span> &#123;<br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (p&lt;&lt;1)</span><br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (p&lt;&lt;1|1)</span><br>	T t[N&lt;&lt;<span class="hljs-number">2</span>];<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_up</span><span class="hljs-params">(ll p)</span> </span>&#123;t[p]=t[ls]+t[rs];&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll x, ll l, ll r, ll p, ll k)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (l==r) <span class="hljs-keyword">return</span> t[p].<span class="hljs-built_in">ins</span>(k), <span class="hljs-built_in">void</span>();<br>		ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (x&lt;=mid) <span class="hljs-built_in">modify</span>(x, l, mid, ls, k);<br>		<span class="hljs-keyword">if</span> (x&gt;mid) <span class="hljs-built_in">modify</span>(x, mid+<span class="hljs-number">1</span>, r, rs, k);<br>		<span class="hljs-built_in">push_up</span>(p);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll x, ll k)</span> </span>&#123;<span class="hljs-built_in">modify</span>(x, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, k);&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(ll nl, ll nr, ll l, ll r, ll p)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (nl&lt;=l&amp;&amp;r&lt;=nr) <span class="hljs-keyword">return</span> t[p];<br>		T res=<span class="hljs-built_in">T</span>(); ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (nl&lt;=mid) res=res+<span class="hljs-built_in">query</span>(nl, nr, l, mid, ls);<br>		<span class="hljs-keyword">if</span> (nr&gt;mid) res=res+<span class="hljs-built_in">query</span>(nl, nr, mid+<span class="hljs-number">1</span>, r, rs);<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(ll l, ll r)</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(l, r, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);&#125;<br>&#125;;<br><br>ll m, opt, l, r, k, pr;<br>seg&lt;LinerBasis&gt; t;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;a.in&quot;, &quot;r&quot;, stdin);</span><br>	m=<span class="hljs-built_in">read</span>(), n=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">while</span> (m--) &#123;<br>		opt=<span class="hljs-built_in">read</span>(), l=<span class="hljs-built_in">read</span>(), r=<span class="hljs-built_in">read</span>();<br>		<span class="hljs-keyword">if</span> (opt==<span class="hljs-number">1</span>) &#123;<br>			t.<span class="hljs-built_in">modify</span>(l, r);<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%llu\n&quot;</span>, t.<span class="hljs-built_in">query</span>(l, r).<span class="hljs-built_in">qmax</span>());<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="T4-线段树套线性基-区间修区间查"><a href="#T4-线段树套线性基-区间修区间查" class="headerlink" title="T4 线段树套线性基 区间修区间查"></a>T4 线段树套线性基 区间修区间查</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5607">洛谷P5607</a> [Ynoi2013] 无力回天 NOI2017</p>
<p>思路和上一题差不多，使用差分完成区间修改。</p>
<p>可以参考<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/2ulffctx">题解</a>理解一下。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173591308">AC</a> 33.08MB 31.36s</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> V 30</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ull;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LinerBasis</span> &#123;<br>	ull a[V+<span class="hljs-number">1</span>];<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-built_in">memset</span>(a, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(a));&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ins</span><span class="hljs-params">(ull x)</span> </span>&#123;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=V; ~i; --i) <span class="hljs-keyword">if</span> (x&amp;<span class="hljs-number">1ULL</span>&lt;&lt;i) &#123;<br>			<span class="hljs-keyword">if</span> (!a[i]) <span class="hljs-keyword">return</span> a[i]=x, <span class="hljs-built_in">void</span>();<br>			x^=a[i];<br>		&#125;<br>	&#125;<br>	<span class="hljs-function">ull <span class="hljs-title">qmax</span><span class="hljs-params">()</span> </span>&#123;<br>		ull res=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=V; ~i; --i) res=<span class="hljs-built_in">max</span>(res, res^a[i]);<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>&#125;;<br><br>LinerBasis <span class="hljs-keyword">operator</span>+(LinerBasis a, LinerBasis b) &#123;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=V; ~i; --i) <span class="hljs-keyword">if</span> (b.a[i]) a.<span class="hljs-built_in">ins</span>(b.a[i]);<br>	<span class="hljs-keyword">return</span> a;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 50010</span><br>ll n, a[N];<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">struct</span> <span class="hljs-title class_">seg</span> &#123;<br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (p&lt;&lt;1)</span><br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (p&lt;&lt;1|1)</span><br>	T t[N&lt;&lt;<span class="hljs-number">2</span>];<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_up</span><span class="hljs-params">(ll p)</span> </span>&#123;t[p]=t[ls]+t[rs];&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(ll p, ll l, ll r)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (l==r) <span class="hljs-keyword">return</span> t[p].<span class="hljs-built_in">ins</span>(a[l]), <span class="hljs-built_in">void</span>(); ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-built_in">build</span>(ls, l, mid), <span class="hljs-built_in">build</span>(rs, mid+<span class="hljs-number">1</span>, r), <span class="hljs-built_in">push_up</span>(p);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n);&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll x, ll l, ll r, ll p, ll k)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (l==r) <span class="hljs-keyword">return</span> t[p].<span class="hljs-built_in">clear</span>(), t[p].<span class="hljs-built_in">ins</span>(a[l]^=k), <span class="hljs-built_in">void</span>();<br>		ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (x&lt;=mid) <span class="hljs-built_in">modify</span>(x, l, mid, ls, k);<br>		<span class="hljs-keyword">if</span> (x&gt;mid) <span class="hljs-built_in">modify</span>(x, mid+<span class="hljs-number">1</span>, r, rs, k);<br>		<span class="hljs-built_in">push_up</span>(p);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll x, ll k)</span> </span>&#123;<span class="hljs-built_in">modify</span>(x, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, k);&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(ll nl, ll nr, ll l, ll r, ll p)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (nl&lt;=l&amp;&amp;r&lt;=nr) <span class="hljs-keyword">return</span> t[p];<br>		T res=<span class="hljs-built_in">T</span>(); ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (nl&lt;=mid) res=res+<span class="hljs-built_in">query</span>(nl, nr, l, mid, ls);<br>		<span class="hljs-keyword">if</span> (nr&gt;mid) res=res+<span class="hljs-built_in">query</span>(nl, nr, mid+<span class="hljs-number">1</span>, r, rs);<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(ll l, ll r)</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(l, r, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);&#125;<br>&#125;;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">struct</span> <span class="hljs-title class_">BIT</span> &#123;<br>	T c[N]; <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>&#123;<span class="hljs-keyword">return</span> x&amp;(~x+<span class="hljs-number">1</span>);&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(<span class="hljs-type">int</span> x, T k)</span> </span>&#123;<span class="hljs-keyword">while</span> (x&lt;=n) c[x]=c[x]^k, x+=<span class="hljs-built_in">lowbit</span>(x);&#125;<br>	<span class="hljs-function">T <span class="hljs-title">g</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>&#123;T ans=<span class="hljs-built_in">T</span>(); <span class="hljs-keyword">while</span> (x&gt;<span class="hljs-number">0</span>) ans=ans^c[x], x-=<span class="hljs-built_in">lowbit</span>(x); <span class="hljs-keyword">return</span> ans;&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">g</span>(x);&#125;<br>&#125;;<br><br>ll m, opt, l, r, k, pr;<br>seg&lt;LinerBasis&gt; t;<br>BIT&lt;<span class="hljs-type">int</span>&gt; ta;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;f.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) a[i]=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=n; i&gt;=<span class="hljs-number">2</span>; --i) a[i]^=a[i<span class="hljs-number">-1</span>];<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) ta.<span class="hljs-built_in">modify</span>(i, a[i]);<br>	t.<span class="hljs-built_in">build</span>();<br>	<span class="hljs-keyword">while</span> (m--) &#123;<br>		opt=<span class="hljs-built_in">read</span>(), l=<span class="hljs-built_in">read</span>(), r=<span class="hljs-built_in">read</span>(), k=<span class="hljs-built_in">read</span>();<br>		<span class="hljs-keyword">if</span> (opt==<span class="hljs-number">1</span>) &#123;<br>			ta.<span class="hljs-built_in">modify</span>(l, k), t.<span class="hljs-built_in">modify</span>(l, k);<br>			<span class="hljs-keyword">if</span> (r&lt;n) ta.<span class="hljs-built_in">modify</span>(r+<span class="hljs-number">1</span>, k), t.<span class="hljs-built_in">modify</span>(r+<span class="hljs-number">1</span>, k);<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			pr=ta.<span class="hljs-built_in">query</span>(l);<br>			<span class="hljs-keyword">if</span> (l==r) &#123;<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, <span class="hljs-built_in">max</span>(pr^k, k)); <span class="hljs-keyword">continue</span>;&#125;<br>			LinerBasis cur=t.<span class="hljs-built_in">query</span>(l+<span class="hljs-number">1</span>, r);<br>			cur.<span class="hljs-built_in">ins</span>(pr);<br>			<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=V; ~i; --i) k=<span class="hljs-built_in">max</span>(<span class="hljs-number">1ULL</span>*k, <span class="hljs-number">1ULL</span>*k^cur.a[i]);<br>			<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, k);<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<hr>
<h3 id="组合数学"><a href="#组合数学" class="headerlink" title="组合数学"></a>组合数学</h3><h4 id="T1-基础好题"><a href="#T1-基础好题" class="headerlink" title="T1 基础好题"></a>T1 基础好题</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5689">洛谷P5689</a> [CSP-S2019 江西] 多叉堆</p>
<p>题意较为复杂，请移步洛谷查看。</p>
<p>维护两个信息：$\text{siz}_x$ 表示以 $x$ 为根的子树 $T_x$ 的大小，$\text{ans}_x$ 表示 $T_x$ 所能填的二叉堆个数 (即本题所求答案)。</p>
<!--下面的LaTeX开始大面积地爆了-->
<!--出现“}_{”就需要换为“}\_{”-->

<p>现在要将 $T_y$ 合并到 $T_x$ 上。<br>堆的结构是确定的。这里一共有 $\text{siz}_{x\leftarrow y}$ 个数，其中一个填到根节点 (这个必然是最小的 $0$)，剩下的填到两个地方：一是 $T_x$ 的子树，二是合并过来的 $T_y$。<br>从 $\text{siz}_{x\leftarrow y}-1$ 中任选 $\text{siz}_y$ 个填到 $T_y$，剩下的填到 $T_x$ 子树中。</p>
<p>将 $\text{siz}_y$ 个数填到 $T_y$ 的方案数为 $\text{ans}_y$；将 $\text{siz}_x-1$ 个数填到 $\text{Subtree}_x$ 的方案数为 $\text{ans}_x$ (因为根节点是确定的，对方案数不做贡献)。</p>
<p>依据乘法原理，将 $\text{siz}_{x\leftarrow y}$ 个数放到 $T_{x\leftarrow y}$ 中的方案数 $\text{ans}_{x\leftarrow y}&#x3D;\text{ans}_{x}\times\text{ans}_y\times\begin{pmatrix}\text{siz}_y\\text{siz}_{x\leftarrow y}-1\end{pmatrix}$。</p>
<p>注意到操作只与每棵树的根节点有关，考虑使用并查集+路径压缩维护。<br>答案只在合并树时更新，故在 <code>merge()</code> 函数内完成计算。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/176172364">AC</a> 12.89MB 368ms<br>原先代码中的 $x$ 和 $y$ 与上文是反的。下面的代码调过来了，和上文一致。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mod 1000000007LL</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 300010</span><br>ll n, q, opt, lstans, t1, t2;<br>ll fac[N], inv[N], ans[N], siz[N], fa[N];<br><br><span class="hljs-function">ll <span class="hljs-title">qpow</span><span class="hljs-params">(ll a, ll b)</span> </span>&#123;<br>	ll res=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">while</span> (b) &#123;<span class="hljs-keyword">if</span> (b&amp;<span class="hljs-number">1</span>) res=res*a%mod; a=a*a%mod, b&gt;&gt;=<span class="hljs-number">1</span>;&#125;<br>	<span class="hljs-keyword">return</span> res;<br>&#125;<br><br><span class="hljs-function">ll <span class="hljs-title">A</span><span class="hljs-params">(ll n, ll m)</span> </span>&#123;<span class="hljs-keyword">return</span> fac[n]*inv[n-m]%mod;&#125;<br><span class="hljs-function">ll <span class="hljs-title">C</span><span class="hljs-params">(ll n, ll m)</span> </span>&#123;<span class="hljs-keyword">return</span> fac[n]*inv[n-m]%mod*inv[m]%mod;&#125;<br><br><span class="hljs-function">ll <span class="hljs-title">find</span><span class="hljs-params">(ll x)</span> </span>&#123;<span class="hljs-keyword">return</span> fa[x]==x?x:fa[x]=<span class="hljs-built_in">find</span>(fa[x]);&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(ll y, ll x)</span> </span>&#123;<br>	y=<span class="hljs-built_in">find</span>(y), x=<span class="hljs-built_in">find</span>(x), siz[x]+=siz[y];<br>	ans[x]=ans[x]*ans[y]%mod*<span class="hljs-built_in">C</span>(siz[x]<span class="hljs-number">-1</span>, siz[y])%mod;<br>	fa[y]=x; <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;c.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), q=<span class="hljs-built_in">read</span>(), fac[<span class="hljs-number">0</span>]=siz[<span class="hljs-number">0</span>]=ans[<span class="hljs-number">0</span>]=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">for</span> (ll i=<span class="hljs-number">1</span>; i&lt;=n; ++i) fa[i]=i, siz[i]=ans[i]=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">for</span> (ll i=<span class="hljs-number">1</span>; i&lt;=n; ++i) fac[i]=fac[i<span class="hljs-number">-1</span>]*i%mod;<br>	inv[n]=<span class="hljs-built_in">qpow</span>(fac[n], mod<span class="hljs-number">-2LL</span>);<br>	<span class="hljs-keyword">for</span> (ll i=n<span class="hljs-number">-1</span>; ~i; --i) inv[i]=inv[i+<span class="hljs-number">1</span>]*(i+<span class="hljs-number">1LL</span>)%mod;<br>	<span class="hljs-keyword">for</span> (ll i=<span class="hljs-number">1</span>; i&lt;=q; ++i) &#123;<br>		opt=<span class="hljs-built_in">read</span>();<br>		<span class="hljs-keyword">if</span> (opt==<span class="hljs-number">1</span>) &#123;<br>			t1=(<span class="hljs-built_in">read</span>()+lstans)%n, t2=(<span class="hljs-built_in">read</span>()+lstans)%n;<br>			<span class="hljs-built_in">merge</span>(t1, t2);<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			t1=(<span class="hljs-built_in">read</span>()+lstans)%n, t1=<span class="hljs-built_in">find</span>(t1), lstans=ans[t1];<br>			<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, lstans);<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<hr>
<h3 id="矩阵乘法"><a href="#矩阵乘法" class="headerlink" title="矩阵乘法"></a>矩阵乘法</h3><p>左行右列：左边第 $i$ 行和右边第 $i$ 列依次相乘取和。<br>$$<br>C&#x3D;A\times B\\<br>C_{i,j}&#x3D;\sum_{k&#x3D;1}^nA_{i,k}B_{k,j}<br>$$<br>详见<a target="_blank" rel="noopener" href="https://oi-wiki.org/math/linear-algebra/matrix/#%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95">OI-Wiki</a>。</p>
<h4 id="常数优化"><a href="#常数优化" class="headerlink" title="常数优化"></a>常数优化</h4><p>枚举循环变量的顺序会影响到空间的连续性。这里将 $k$ 放在 $j$ 前面枚举，保证访问的是连续的若干段内存。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp">Matrix <span class="hljs-keyword">operator</span>*(Matrix &amp;a, Matrix &amp;b) &#123;<br>	Matrix z=<span class="hljs-built_in">Matrix</span>(); z.n=a.n, z.m=b.m;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=a.n; ++i) <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>; j&lt;=a.m; ++j) &#123;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k=<span class="hljs-number">1</span>; k&lt;=b.m; ++k) z[i][k]=(z[i][k]+a[i][j]*b[j][k])%MOD;<br>	&#125;<br>	<span class="hljs-keyword">return</span> z;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h3 id="矩阵快速幂"><a href="#矩阵快速幂" class="headerlink" title="矩阵快速幂"></a>矩阵快速幂</h3><p>和普通的快速幂一样，使用二进制优化幂运算。</p>
<p>具体地，使用倍增思想。<br>根据幂运算法则 $x^{a+b}&#x3D;x^a\times x^b$、$(x^a)^b&#x3D;x^{ab}$，二进制优化，计算整 $2^k$ 指数的结果，最后相乘即可得到答案。<br>时间复杂度 $O(\log n)$，其中 $n$ 为迭代次数。</p>
<p>代码实现上，使用结构体实现矩阵，增加代码简洁度。<br>其中，<code>.n</code> 表示行数，<code>.m</code> 表示列数。<br><code>operator[]</code> 表示中括号运算符，可类二维数组修改矩阵元素。例如，<code>a[i][j]</code> 表示第 $i$ 行第 $j$ 列的元素。</p>
<h4 id="T1-模板"><a href="#T1-模板" class="headerlink" title="T1 模板"></a>T1 模板</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3390">洛谷P3390</a> 矩阵快速幂</p>
<p>给定 $n\times n$ 的矩阵 $A$，求 $A^k$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ull;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ull <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ull x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MN 110</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MM 110</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MOD 1000000007ULL</span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Matrix</span> &#123;<br>	<span class="hljs-type">int</span> n, m; ull d[MN][MM];<br>	ull* <span class="hljs-keyword">operator</span>[](<span class="hljs-type">int</span> x) &#123;<span class="hljs-keyword">return</span> d[x];&#125;<br>	<span class="hljs-built_in">Matrix</span>() &#123;n=<span class="hljs-number">0</span>, m=<span class="hljs-number">0</span>, <span class="hljs-built_in">memset</span>(d, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(d));&#125;<br>&#125;;<br><br>Matrix <span class="hljs-keyword">operator</span>*(Matrix &amp;a, Matrix &amp;b) &#123;<br>	Matrix z=<span class="hljs-built_in">Matrix</span>(); z.n=a.n, z.m=b.m;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=a.n; ++i) <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>; j&lt;=a.m; ++j) &#123;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k=<span class="hljs-number">1</span>; k&lt;=b.m; ++k) z[i][k]=(z[i][k]+a[i][j]*b[j][k])%MOD;<br>	&#125;<br>	<span class="hljs-keyword">return</span> z;<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-keyword">operator</span>*=(Matrix &amp;a, Matrix b) &#123;a=a*b;&#125;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-function">T <span class="hljs-title">qpow</span><span class="hljs-params">(T a, ull b)</span> </span>&#123;<br>	T res=a; --b;<br>	<span class="hljs-keyword">while</span> (b) &#123;<span class="hljs-keyword">if</span> (b&amp;<span class="hljs-number">1</span>) res*=a; a*=a, b&gt;&gt;=<span class="hljs-number">1</span>;&#125;<br>	<span class="hljs-keyword">return</span> res;<br>&#125;<br><br><span class="hljs-type">int</span> n; ull k;<br>Matrix a;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;a.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), k=<span class="hljs-built_in">read</span>(), a.n=n, a.m=n;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>; j&lt;=n; ++j) a[i][j]=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">if</span> (k==<span class="hljs-number">0</span>) &#123;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) &#123;<br>			<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>; j&lt;=n; ++j) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d &quot;</span>, i==j); <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;&quot;</span>);<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>	&#125;<br>	a=<span class="hljs-built_in">qpow</span>(a, k);<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) &#123;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>; j&lt;=n; ++j) <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%llu &quot;</span>, a[i][j]); <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;&quot;</span>);<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="矩阵快速幂加速递推"><a href="#矩阵快速幂加速递推" class="headerlink" title="矩阵快速幂加速递推"></a>矩阵快速幂加速递推</h4><p>以行向量为例，</p>
<ul>
<li>求解问题特点：<ol>
<li>可以抽象出长度为 $n$ 的一维向量，该向量在每个单位时间发生一次变化；</li>
<li>变化的形式是一个线性递推，仅包含加法和乘系数运算；</li>
<li>该递推式在每个时间可能作用于不同的数据上，但本身保持不变；</li>
<li>向量变化时间很长，但向量长度 $n$ 不大。</li>
</ol>
</li>
<li>构造矩阵：<ol>
<li>状态矩阵：长度为 $n$ 的一维向量；</li>
<li>转移矩阵：参加快速幂运算的不变的矩阵；</li>
<li>构造矩阵时，要将求解所求答案所需元素放入构造矩阵中；</li>
<li>若状态矩阵第 $x$ 个数对下一时间状态矩阵第 $y$ 个数产生影响，则应修改转移矩阵第 $x$ 行第 $y$ 列的数。</li>
</ol>
</li>
</ul>
<h4 id="T2-递推式某项"><a href="#T2-递推式某项" class="headerlink" title="T2 递推式某项"></a>T2 递推式某项</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1962">洛谷P1962</a> 斐波那契数列</p>
<p>$$<br>F_n&#x3D;\begin{cases}<br>1&amp;n\le2\\<br>F_{n-1}+F_{n-2}&amp;n\ge3<br>\end{cases}<br>$$</p>
<p>求 $F_n\operatorname{mod}10^9+7$ 的值。</p>
<p>$$<br>\begin{aligned}<br>&amp;f_i&#x3D;f_{i-1}+f_{i-2}\\<br>\Rightarrow&amp;<br>\begin{bmatrix}f_i&amp;f_{i-1}\end{bmatrix}&#x3D;<br>\begin{bmatrix}f_{i-1}&amp;f_{i-2}\end{bmatrix}<br>\begin{bmatrix}1&amp;1\\1&amp;0\end{bmatrix}\\<br>\Rightarrow&amp;<br>\begin{bmatrix}f_n&amp;f_{n-1}\end{bmatrix}&#x3D;<br>\begin{bmatrix}1&amp;1\end{bmatrix}<br>\begin{bmatrix}1&amp;1\\1&amp;0\end{bmatrix}^{n-2}<br>\end{aligned}<br>$$</p>
<p>我们可以使用快速幂的方式计算出右侧矩阵，从而 $O(\log n)$ 地求出递推结果。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/174891972">AC</a> 1.10MB 44ms</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ull;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ull <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ull x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MN 110</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MM 110</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MOD 1000000007ULL</span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Matrix</span> &#123;<br>	<span class="hljs-type">int</span> n, m; ull d[MN][MM];<br>	ull* <span class="hljs-keyword">operator</span>[](<span class="hljs-type">int</span> x) &#123;<span class="hljs-keyword">return</span> d[x];&#125;<br>	<span class="hljs-built_in">Matrix</span>() &#123;n=<span class="hljs-number">0</span>, m=<span class="hljs-number">0</span>, <span class="hljs-built_in">memset</span>(d, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(d));&#125;<br>&#125;;<br><br>Matrix <span class="hljs-keyword">operator</span>*(Matrix &amp;a, Matrix &amp;b) &#123;<br>	Matrix z=<span class="hljs-built_in">Matrix</span>(); z.n=a.n, z.m=b.m;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=a.n; ++i) <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>; j&lt;=a.m; ++j) &#123;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k=<span class="hljs-number">1</span>; k&lt;=b.m; ++k) z[i][k]=(z[i][k]+a[i][j]*b[j][k])%MOD;<br>	&#125;<br>	<span class="hljs-keyword">return</span> z;<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-keyword">operator</span>*=(Matrix &amp;a, Matrix b) &#123;a=a*b;&#125;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-function">T <span class="hljs-title">qpow</span><span class="hljs-params">(T a, ull b)</span> </span>&#123;<br>	T res=a; --b;<br>	<span class="hljs-keyword">while</span> (b) &#123;<span class="hljs-keyword">if</span> (b&amp;<span class="hljs-number">1</span>) res*=a; a*=a, b&gt;&gt;=<span class="hljs-number">1</span>;&#125;<br>	<span class="hljs-keyword">return</span> res;<br>&#125;<br><br>ull n;<br>Matrix a, b, ans;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;a.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">if</span> (n&lt;=<span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;1&quot;</span>), <span class="hljs-number">0</span>;<br>	a.n=<span class="hljs-number">1</span>, a.m=<span class="hljs-number">2</span>, b.n=<span class="hljs-number">2</span>, b.m=<span class="hljs-number">2</span>;<br>	a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>, a[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]=<span class="hljs-number">1</span>;<br>	b[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]=<span class="hljs-number">0</span>, b[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]=<span class="hljs-number">1</span>, b[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>, b[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]=<span class="hljs-number">1</span>;<br>	ans=a, ans*=<span class="hljs-built_in">qpow</span>(b, n<span class="hljs-number">-2</span>), <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%llu\n&quot;</span>, ans[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="T3-递推式平方和"><a href="#T3-递推式平方和" class="headerlink" title="T3 递推式平方和"></a>T3 递推式平方和</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5175">洛谷P5175</a> 数列</p>
<p>一个数列 $a_n$，已知 $a_1$ 和 $a_2$。数列满足递推式 $a_n&#x3D;x\times a_{n-1}+y\times a_{n-2}\ (n\ge3)$，求 $\sum\limits_{i&#x3D;1}^na_i^2$。<br>$T$ 组数据，每组五个数分别代表 $n$、$a_1$、$a_2$、$x$、$y$。</p>
<p>由于答案求的是平方和，所以考虑以 $S_i$ 和 $a_i^2$ 为核心元素构造矩阵。最终构造出的矩阵为：<br>$$<br>\begin{bmatrix}<br>S_i\\<br>x^2a_i^2+y^2a_{i-1}^2+2xya_ia_{i-1}\\<br>a_i^2\\<br>xa_i^2+ya_ia_{i-1}<br>\end{bmatrix}&#x3D;\begin{bmatrix}<br>1&amp;1&amp;0&amp;0\\<br>0&amp;x^2&amp;y^2&amp;2xy\\<br>0&amp;1&amp;0&amp;0\\<br>0&amp;x&amp;0&amp;y<br>\end{bmatrix}\times\begin{bmatrix}<br>S_{i-1}\\<br>a_i^2\\<br>a_{i-1}^2\\<br>a_ia_{i-1}<br>\end{bmatrix}<br>$$<br>详细构造过程可以看<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/94dtnhh9">这篇题解</a>。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173976160">AC</a> 1.43MB 3.13s</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MN 10</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MM 10</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MOD 1000000007LL</span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Matrix</span> &#123;<br>	<span class="hljs-type">int</span> n, m; ll d[MN][MM];<br>	ll* <span class="hljs-keyword">operator</span>[](<span class="hljs-type">int</span> x) &#123;<span class="hljs-keyword">return</span> d[x];&#125;<br>	<span class="hljs-built_in">Matrix</span>() &#123;n=<span class="hljs-number">0</span>, m=<span class="hljs-number">0</span>, <span class="hljs-built_in">memset</span>(d, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(d));&#125;<br>&#125;;<br><br>Matrix <span class="hljs-keyword">operator</span>*(Matrix &amp;a, Matrix &amp;b) &#123;<br>	Matrix z=<span class="hljs-built_in">Matrix</span>(); z.n=a.n, z.m=b.m; <span class="hljs-comment">// a.m=b.n</span><br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=a.n; ++i) <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>; j&lt;=a.m; ++j) &#123;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k=<span class="hljs-number">1</span>; k&lt;=b.m; ++k) z[i][k]=(z[i][k]+a[i][j]*b[j][k])%MOD;<br>	&#125;<br>	<span class="hljs-keyword">return</span> z;<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-keyword">operator</span>*=(Matrix &amp;a, Matrix b) &#123;a=a*b;&#125;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-function">T <span class="hljs-title">qpow</span><span class="hljs-params">(T a, ll b)</span> </span>&#123;<br>	T res=a; --b;<br>	<span class="hljs-keyword">while</span> (b) &#123;<span class="hljs-keyword">if</span> (b&amp;<span class="hljs-number">1</span>) res*=a; a*=a, b&gt;&gt;=<span class="hljs-number">1</span>;&#125;<br>	<span class="hljs-keyword">return</span> res;<br>&#125;<br><br><span class="hljs-type">int</span> T;<br>ll n, a1, a2, x, y;<br>Matrix a, b, ans;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;b.in&quot;, &quot;r&quot;, stdin);</span><br>	T=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">while</span> (T--) &#123;<br>		n=<span class="hljs-built_in">read</span>(), a1=<span class="hljs-built_in">read</span>()%MOD, a2=<span class="hljs-built_in">read</span>()%MOD, x=<span class="hljs-built_in">read</span>()%MOD, y=<span class="hljs-built_in">read</span>()%MOD;<br>		<span class="hljs-keyword">if</span> (n==<span class="hljs-number">1</span>) &#123;<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, a1*a1%MOD); <span class="hljs-keyword">continue</span>;&#125;<br>		a=b=ans=<span class="hljs-built_in">Matrix</span>(), a.n=b.n=b.m=<span class="hljs-number">4</span>, a.m=<span class="hljs-number">1</span>;<br>		a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]=a[<span class="hljs-number">3</span>][<span class="hljs-number">1</span>]=a1*a1%MOD, a[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>]=a2*a2%MOD, a[<span class="hljs-number">4</span>][<span class="hljs-number">1</span>]=a1*a2%MOD;<br>		b[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]=b[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]=b[<span class="hljs-number">3</span>][<span class="hljs-number">2</span>]=<span class="hljs-number">1</span>;<br>		b[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]=x*x%MOD, b[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>]=y*y%MOD, b[<span class="hljs-number">2</span>][<span class="hljs-number">4</span>]=<span class="hljs-number">2</span>*x*y%MOD;<br>		b[<span class="hljs-number">4</span>][<span class="hljs-number">2</span>]=x, b[<span class="hljs-number">4</span>][<span class="hljs-number">4</span>]=y; ans=<span class="hljs-built_in">qpow</span>(b, n<span class="hljs-number">-1</span>), ans*=a;<br>		<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, ans[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]);<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="T4-加速DP"><a href="#T4-加速DP" class="headerlink" title="T4 加速DP"></a>T4 加速DP</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2106">洛谷P2106</a> Sam数</p>
<p>求有多少长为 $n$ 位且满足相邻位之差小于等于 $2$ 的数。</p>
<p>先考虑数位 DP。设 $f_{i,j}$ 表示第 $i$ 位为 $j$ 时的方案数。</p>
<p>初始状态：$f_{1,1}&#x3D;f_{1,2}&#x3D;\dots&#x3D;f_{1,9}&#x3D;1$。<br>$f_{1,0}&#x3D;0$，去除前导零。</p>
<p>转移方程：<br>$$<br>f_{i,j}&#x3D;\sum_{k&#x3D;j-2}^{j+2}f_{i-1,k}<br>$$<br>两个状态，可以约束数位和数字。每一位数字只与前一位有约束关系，故状态转移方程正确。</p>
<p>根据状态转移方程构造矩阵。<br>$$<br>\begin{bmatrix}<br>f_{i+1,0}&amp;f_{i+1,1}&amp;\dots&amp;f_{i+1,9}<br>\end{bmatrix}&#x3D;\begin{bmatrix}<br>f_{i,0}&amp;f_{i,1}&amp;\dots&amp;f_{i,9}<br>\end{bmatrix}\times\begin{bmatrix}<br>1&amp;1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\<br>1&amp;1&amp;1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0\\<br>1&amp;1&amp;1&amp;1&amp;1&amp;0&amp;0&amp;0&amp;0&amp;0\\<br>0&amp;1&amp;1&amp;1&amp;1&amp;1&amp;0&amp;0&amp;0&amp;0\\<br>0&amp;0&amp;1&amp;1&amp;1&amp;1&amp;1&amp;0&amp;0&amp;0\\<br>0&amp;0&amp;0&amp;1&amp;1&amp;1&amp;1&amp;1&amp;0&amp;0\\<br>0&amp;0&amp;0&amp;0&amp;1&amp;1&amp;1&amp;1&amp;1&amp;0\\<br>0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;1&amp;1&amp;1&amp;1\\<br>0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;1&amp;1&amp;1\\<br>0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;0&amp;1&amp;1&amp;1\\<br>\end{bmatrix}<br>$$</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/174887953">AC</a> 1.10MB 44ms</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ull;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ull <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ull x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MN 110</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MM 110</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MOD 1000000007ULL</span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Matrix</span> &#123;<br>	<span class="hljs-type">int</span> n, m; ull d[MN][MM];<br>	ull* <span class="hljs-keyword">operator</span>[](<span class="hljs-type">int</span> x) &#123;<span class="hljs-keyword">return</span> d[x];&#125;<br>	<span class="hljs-built_in">Matrix</span>() &#123;n=<span class="hljs-number">0</span>, m=<span class="hljs-number">0</span>, <span class="hljs-built_in">memset</span>(d, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(d));&#125;<br>&#125;;<br><br>Matrix <span class="hljs-keyword">operator</span>*(Matrix &amp;a, Matrix &amp;b) &#123;<br>	Matrix z=<span class="hljs-built_in">Matrix</span>(); z.n=a.n, z.m=b.m;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=a.n; ++i) <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>; j&lt;=a.m; ++j) &#123;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> k=<span class="hljs-number">1</span>; k&lt;=b.m; ++k) z[i][k]=(z[i][k]+a[i][j]*b[j][k])%MOD;<br>	&#125;<br>	<span class="hljs-keyword">return</span> z;<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-keyword">operator</span>*=(Matrix &amp;a, Matrix b) &#123;a=a*b;&#125;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-function">T <span class="hljs-title">qpow</span><span class="hljs-params">(T a, ull b)</span> </span>&#123;<br>	T res=a; --b;<br>	<span class="hljs-keyword">while</span> (b) &#123;<span class="hljs-keyword">if</span> (b&amp;<span class="hljs-number">1</span>) res*=a; a*=a, b&gt;&gt;=<span class="hljs-number">1</span>;&#125;<br>	<span class="hljs-keyword">return</span> res;<br>&#125;<br><br>ull n, ans;<br>Matrix a, b;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;a.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), a.m=b.n=b.m=<span class="hljs-number">10</span>, a.n=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">if</span> (n==<span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;10&quot;</span>), <span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">2</span>; i&lt;=<span class="hljs-number">10</span>; ++i) a[<span class="hljs-number">1</span>][i]=<span class="hljs-number">1</span>; <span class="hljs-comment">// a[1][1]=0 -&gt; 去除前导零</span><br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">10</span>; ++i) &#123;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>, i<span class="hljs-number">-2</span>); j&lt;=<span class="hljs-built_in">min</span>(<span class="hljs-number">10</span>, i+<span class="hljs-number">2</span>); ++j) &#123;<br>			b[i][j]=<span class="hljs-number">1</span>;<br>		&#125;<br>	&#125;<br>	b=<span class="hljs-built_in">qpow</span>(b, n<span class="hljs-number">-1</span>), a=a*b;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">10</span>; ++i) ans=(ans+a[<span class="hljs-number">1</span>][i])%MOD;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%llu\n&quot;</span>, ans);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<hr>
<h3 id="线段树"><a href="#线段树" class="headerlink" title="线段树"></a>线段树</h3><h4 id="T1-区间取反与连续信息查询"><a href="#T1-区间取反与连续信息查询" class="headerlink" title="T1 区间取反与连续信息查询"></a>T1 区间取反与连续信息查询</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2572">洛谷P2572</a> [SCOI2010] 序列操作</p>
<p>给定零一序列，完成区间覆盖、区间取反、区间查询、区间连续“$1$”个数查询。</p>
<p>考虑同时记录白色数量和黑色数量，这样就不需要记录区间长度计算了。<br>代码中使用结构体 <code>D</code> 表示点的信息，极大缩减代码难度。</p>
<p>记录信息：</p>
<ol>
<li>区间白色数量 <code>w</code>；</li>
<li>区间黑色数量 <code>b</code>；</li>
<li>区间左边开始的连续白色数量 <code>lw</code>；</li>
<li>区间左边开始的连续黑色数量 <code>lb</code>；</li>
<li>区间右边开始的连续白色数量 <code>rw</code>；</li>
<li>区间右边开始的连续黑色数量 <code>rb</code>；</li>
<li>区间连续白色数量 <code>mw</code>；</li>
<li>区间连续黑色数量 <code>mb</code>。</li>
</ol>
<p>合并方式见代码。</p>
<p><code>tg1</code> 表示覆盖懒标记，<code>tg2</code> 表示反转懒标记。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173994834">AC</a> 15.62MB 570ms</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 100010</span><br>ll n;<br>ll buildSource[N];<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">D</span> &#123;<br>	<span class="hljs-type">int</span> w, b, lw, lb, rw, rb, mw, mb;<br>	<span class="hljs-built_in">D</span>(<span class="hljs-type">int</span> nw=<span class="hljs-number">0</span>, <span class="hljs-type">int</span> nb=<span class="hljs-number">0</span>, <span class="hljs-type">int</span> nlw=<span class="hljs-number">0</span>, <span class="hljs-type">int</span> nlb=<span class="hljs-number">0</span>, <span class="hljs-type">int</span> nrw=<span class="hljs-number">0</span>, <span class="hljs-type">int</span> nrb=<span class="hljs-number">0</span>, <br>		<span class="hljs-type">int</span> nmw=<span class="hljs-number">0</span>, <span class="hljs-type">int</span> nmb=<span class="hljs-number">0</span>) &#123;<br>		w=nw, b=nb, lw=nlw, lb=nlb, rw=nrw, rb=nrb, mw=nmw, mb=nmb;<br>	&#125;<br>&#125;;<br><br>D <span class="hljs-keyword">operator</span>+(D a, D b) &#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-built_in">D</span>(a.w+b.w, a.b+b.b, a.b?a.lw:a.w+b.lw, a.w?a.lb:a.b+b.lb,<br>			b.b?b.rw:b.w+a.rw, b.w?b.rb:b.b+a.rb,<br>			<span class="hljs-built_in">max</span>(<span class="hljs-built_in">max</span>(a.mw,b.mw),a.rw+b.lw), <span class="hljs-built_in">max</span>(<span class="hljs-built_in">max</span>(a.mb,b.mb),a.rb+b.lb));<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-keyword">operator</span>+=(D &amp;a, D b) &#123;a=a+b;&#125;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">struct</span> <span class="hljs-title class_">seg</span> &#123;<br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (p&lt;&lt;1)</span><br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (p&lt;&lt;1|1)</span><br>	T t[N&lt;&lt;<span class="hljs-number">2</span>]; <span class="hljs-type">int</span> len[N], tg1[N], tg2[N];<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_up</span><span class="hljs-params">(ll p)</span> </span>&#123;t[p]=t[ls]+t[rs];&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(ll p, ll l, ll r)</span> </span>&#123;<br>		len[p]=r-l+<span class="hljs-number">1</span>, tg1[p]=<span class="hljs-number">-1</span>;<br>		<span class="hljs-keyword">if</span> (l==r) &#123;<span class="hljs-type">int</span> x=buildSource[l]; t[p]=<span class="hljs-built_in">D</span>(x,x^<span class="hljs-number">1</span>,x,x^<span class="hljs-number">1</span>,x,x^<span class="hljs-number">1</span>,x,x^<span class="hljs-number">1</span>); <span class="hljs-keyword">return</span>;&#125;<br>		ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>; <span class="hljs-built_in">build</span>(ls, l, mid), <span class="hljs-built_in">build</span>(rs, mid+<span class="hljs-number">1</span>, r), <span class="hljs-built_in">push_up</span>(p);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n);&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">f</span><span class="hljs-params">(<span class="hljs-type">int</span> p,<span class="hljs-type">int</span> typ)</span> </span>&#123;<br>		D &amp;x=t[p];<br>		<span class="hljs-keyword">if</span>(typ==<span class="hljs-number">0</span>) tg2[p]=<span class="hljs-number">0</span>, tg1[p]=<span class="hljs-number">0</span>, x=<span class="hljs-built_in">D</span>(<span class="hljs-number">0</span>,len[p],<span class="hljs-number">0</span>,len[p],<span class="hljs-number">0</span>,len[p],<span class="hljs-number">0</span>,len[p]);<br>		<span class="hljs-keyword">if</span>(typ==<span class="hljs-number">1</span>) tg2[p]=<span class="hljs-number">0</span>, tg1[p]=<span class="hljs-number">1</span>, x=<span class="hljs-built_in">D</span>(len[p],<span class="hljs-number">0</span>,len[p],<span class="hljs-number">0</span>,len[p],<span class="hljs-number">0</span>,len[p],<span class="hljs-number">0</span>);<br>		<span class="hljs-keyword">if</span>(typ==<span class="hljs-number">2</span>) tg2[p]^=<span class="hljs-number">1</span>,<span class="hljs-built_in">swap</span>(x.w,x.b),<span class="hljs-built_in">swap</span>(x.lw,x.lb),<span class="hljs-built_in">swap</span>(x.rw,x.rb),<span class="hljs-built_in">swap</span>(x.mw,x.mb);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_down</span><span class="hljs-params">(ll p, ll l, ll r)</span> </span>&#123;<br>		ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (~tg1[p]) <span class="hljs-built_in">f</span>(ls, tg1[p]), <span class="hljs-built_in">f</span>(rs, tg1[p]), tg1[p]=<span class="hljs-number">-1</span>;<br>		<span class="hljs-keyword">if</span> (tg2[p]) <span class="hljs-built_in">f</span>(ls, <span class="hljs-number">2</span>), <span class="hljs-built_in">f</span>(rs, <span class="hljs-number">2</span>), tg2[p]=<span class="hljs-number">0</span>;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll nl, ll nr, ll l, ll r, ll p, ll k)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (nl&lt;=l&amp;&amp;r&lt;=nr) <span class="hljs-keyword">return</span> <span class="hljs-built_in">f</span>(p, k), <span class="hljs-built_in">void</span>();<br>		<span class="hljs-built_in">push_down</span>(p, l, r); ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (nl&lt;=mid) <span class="hljs-built_in">modify</span>(nl, nr, l, mid, ls, k);<br>		<span class="hljs-keyword">if</span> (nr&gt;mid) <span class="hljs-built_in">modify</span>(nl, nr, mid+<span class="hljs-number">1</span>, r, rs, k);<br>		<span class="hljs-built_in">push_up</span>(p);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll l, ll r, ll k)</span> </span>&#123;<span class="hljs-built_in">modify</span>(l, r, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, k);&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(ll nl, ll nr, ll l, ll r, ll p)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (nl&lt;=l&amp;&amp;r&lt;=nr) <span class="hljs-keyword">return</span> t[p];<br>		<span class="hljs-built_in">push_down</span>(p, l, r); T res=<span class="hljs-number">0</span>; ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (nl&lt;=mid) res+=<span class="hljs-built_in">query</span>(nl, nr, l, mid, ls);<br>		<span class="hljs-keyword">if</span> (nr&gt;mid) res+=<span class="hljs-built_in">query</span>(nl, nr, mid+<span class="hljs-number">1</span>, r, rs);<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(ll l, ll r)</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(l, r, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);&#125;<br>&#125;;<br><br>seg&lt;D&gt; t;<br><span class="hljs-type">int</span> q, opt, l, r;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;c.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), q=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) buildSource[i]=<span class="hljs-built_in">read</span>();<br>	t.<span class="hljs-built_in">build</span>();<br>	<span class="hljs-keyword">while</span> (q--) &#123;<br>		opt=<span class="hljs-built_in">read</span>(), l=<span class="hljs-built_in">read</span>()+<span class="hljs-number">1</span>, r=<span class="hljs-built_in">read</span>()+<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (opt&lt;=<span class="hljs-number">2</span>) t.<span class="hljs-built_in">modify</span>(l, r, opt);<br>		<span class="hljs-keyword">else</span> &#123;<br>			D x=t.<span class="hljs-built_in">query</span>(l, r);<br>			<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, opt==<span class="hljs-number">3</span>?x.w:x.mw);<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="T2-维护隐含信息"><a href="#T2-维护隐含信息" class="headerlink" title="T2 维护隐含信息"></a>T2 维护隐含信息</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P6327">洛谷P6327</a> 区间加区间 sin 和</p>
<p>非常巧妙的一道题，为了让信息封闭能够合并还需要维护 $\cos$ 值。<br>根据公式，同时维护 $\sin$ 和 $\cos$ 两个信息。<br>$$<br>\sin(\alpha+\beta)&#x3D;\sin\alpha\cos\beta+\cos\alpha\sin\beta\\<br>\cos(\alpha+\beta)&#x3D;\cos\alpha\cos\beta-\sin\alpha\sin\beta<br>$$<br>合并操作见代码。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173544624">AC</a> 20.74MB 3.25s</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 200010</span><br>ll n, bs[N];<br><span class="hljs-type">double</span> k1, k2; <span class="hljs-comment">// sin(k) | cos(k)</span><br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">struct</span> <span class="hljs-title class_">seg</span> &#123;<br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (p&lt;&lt;1)</span><br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (p&lt;&lt;1|1)</span><br>	T t1[N&lt;&lt;<span class="hljs-number">2</span>], t2[N&lt;&lt;<span class="hljs-number">2</span>]; ll tag[N&lt;&lt;<span class="hljs-number">2</span>]; <span class="hljs-comment">// t1-sin t2-cos</span><br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_up</span><span class="hljs-params">(ll p)</span> </span>&#123;t1[p]=t1[ls]+t1[rs], t2[p]=t2[ls]+t2[rs];&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update</span><span class="hljs-params">(ll p, T a1, T a2)</span> </span>&#123;<br>		T u1=t1[p], u2=t2[p]; t1[p]=u1*a2+u2*a1, t2[p]=u2*a2-u1*a1;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(ll p, ll l, ll r)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (l==r) <span class="hljs-keyword">return</span> t1[p]=<span class="hljs-built_in">sin</span>(bs[l]), t2[p]=<span class="hljs-built_in">cos</span>(bs[l]), <span class="hljs-built_in">void</span>();<br>		ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>; <span class="hljs-built_in">build</span>(ls, l, mid), <span class="hljs-built_in">build</span>(rs, mid+<span class="hljs-number">1</span>, r), <span class="hljs-built_in">push_up</span>(p);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n);&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_down</span><span class="hljs-params">(ll p, ll l, ll r)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (!tag[p]) <span class="hljs-keyword">return</span>; T a1=<span class="hljs-built_in">sin</span>(tag[p]), a2=<span class="hljs-built_in">cos</span>(tag[p]);<br>		<span class="hljs-built_in">update</span>(ls, a1, a2), <span class="hljs-built_in">update</span>(rs, a1, a2);<br>		tag[ls]+=tag[p], tag[rs]+=tag[p], tag[p]=<span class="hljs-number">0</span>;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll nl, ll nr, ll l, ll r, ll p, T k)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (nl&lt;=l&amp;&amp;r&lt;=nr) <span class="hljs-keyword">return</span> <span class="hljs-built_in">update</span>(p, k1, k2), tag[p]+=k, <span class="hljs-built_in">void</span>();<br>		<span class="hljs-built_in">push_down</span>(p, l, r); ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (nl&lt;=mid) <span class="hljs-built_in">modify</span>(nl, nr, l, mid, ls, k);<br>		<span class="hljs-keyword">if</span> (nr&gt;mid) <span class="hljs-built_in">modify</span>(nl, nr, mid+<span class="hljs-number">1</span>, r, rs, k);<br>		<span class="hljs-built_in">push_up</span>(p);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll l, ll r, T k)</span> </span>&#123;<span class="hljs-built_in">modify</span>(l, r, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, k);&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(ll nl, ll nr, ll l, ll r, ll p)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (nl&lt;=l&amp;&amp;r&lt;=nr) <span class="hljs-keyword">return</span> t1[p];<br>		<span class="hljs-built_in">push_down</span>(p, l, r); T res=<span class="hljs-number">0</span>; ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (nl&lt;=mid) res+=<span class="hljs-built_in">query</span>(nl, nr, l, mid, ls);<br>		<span class="hljs-keyword">if</span> (nr&gt;mid) res+=<span class="hljs-built_in">query</span>(nl, nr, mid+<span class="hljs-number">1</span>, r, rs);<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(ll l, ll r)</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(l, r, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);&#125;<br>&#125;;<br><br>seg&lt;<span class="hljs-type">double</span>&gt; t;<br>ll q, opt, l, r, k;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;d.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) bs[i]=<span class="hljs-built_in">read</span>();<br>	t.<span class="hljs-built_in">build</span>(), q=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">while</span> (q--) &#123;<br>		opt=<span class="hljs-built_in">read</span>(), l=<span class="hljs-built_in">read</span>(), r=<span class="hljs-built_in">read</span>();<br>		<span class="hljs-keyword">if</span> (opt==<span class="hljs-number">1</span>) &#123;<br>			k=<span class="hljs-built_in">read</span>(), k1=<span class="hljs-built_in">sin</span>(k), k2=<span class="hljs-built_in">cos</span>(k);<br>			t.<span class="hljs-built_in">modify</span>(l, r, k);<br>		&#125; <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%.1lf\n&quot;</span>, t.<span class="hljs-built_in">query</span>(l, r));<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="T3-结合二分答案"><a href="#T3-结合二分答案" class="headerlink" title="T3 结合二分答案"></a>T3 结合二分答案</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2824">洛谷P2824</a> [HEOI2016&#x2F;TJOI2016] 排序</p>
<p>给定一个序列，需要维护区间升序排序和区间降序排序两个操作，最后询问 $q$ 位置上的数字。</p>
<p>线段树 $\text{0-1 Trick}$：<br>使用二分答案，将排序操作转换为区间和和区间覆盖操作。</p>
<p>二分答案，$q$ 位置上最终为 $x$。将所有大于等于 $x$ 的数设为 $1$，所有小于 $x$ 的数设为 $0$。<br>区间排序时，查询区间内 $1$ 的个数 $\text{cnt}$。升序排序将 $[l,r-\text{cnt}]$ 位置设为 $0$，将 $[r-\text{cnt}+1,r]$ 位置设为 $1$；降序排序将 $[l,l+\text{cnt}-1]$ 位置设为 $1$，将 $[l+cnt,r]$ 位置设为 $0$。</p>
<p>注意：线段树更新时需要加上 <code>if(nl&gt;nr||nl&lt;1||nr&gt;n) return;</code>，否则会死循环导致<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173570892">RE</a>。<br>因为序列全为 $0$ 时更新 $[l,l+cnt-1]$ 或全为 $1$ 时更新 $[l,r-cnt+1]$ 都会左端点大于右端点。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173571287">AC</a> 4.86MB 3.70s</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 100010</span><br><span class="hljs-comment">// #define INF -1</span><br>ll n, a[N];<br>ll x;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">struct</span> <span class="hljs-title class_">seg</span> &#123;<br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (p&lt;&lt;1)</span><br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (p&lt;&lt;1|1)</span><br>	T t[N&lt;&lt;<span class="hljs-number">2</span>], tag[N&lt;&lt;<span class="hljs-number">2</span>];<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_up</span><span class="hljs-params">(ll p)</span> </span>&#123;t[p]=t[ls]+t[rs];&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(ll p, ll l, ll r)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (l==r) <span class="hljs-keyword">return</span> t[p]=a[l]&gt;=x, <span class="hljs-built_in">void</span>(); ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-built_in">build</span>(ls, l, mid), <span class="hljs-built_in">build</span>(rs, mid+<span class="hljs-number">1</span>, r);<br>		t[p]=t[ls]+t[rs], tag[p]=<span class="hljs-number">0</span>;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n);&#125;<br>	<span class="hljs-comment">// void f(ll p, ll l, ll r, T k) &#123;t[p]=k*(r-l+1), tag[p]=k;&#125;</span><br>	<span class="hljs-comment">// void push_down(ll p, ll l, ll r) &#123;</span><br>	<span class="hljs-comment">// 	if (tag[p]==INF) return; ll mid=l+r&gt;&gt;1;</span><br>	<span class="hljs-comment">// 	f(ls, l, mid, tag[p]), f(rs, mid+1, r, tag[p]), tag[p]=INF;</span><br>	<span class="hljs-comment">// &#125;</span><br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_down</span><span class="hljs-params">(ll p, ll l, ll r)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (!tag[p]) <span class="hljs-keyword">return</span>; ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		tag[ls]=tag[rs]=tag[p];<br>		<span class="hljs-keyword">if</span> (tag[p]==<span class="hljs-number">1</span>) t[ls]=mid-l+<span class="hljs-number">1</span>, t[rs]=r-mid;<br>		<span class="hljs-keyword">else</span> t[ls]=t[rs]=<span class="hljs-number">0</span>;<br>		tag[p]=<span class="hljs-number">0</span>;<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll nl, ll nr, ll l, ll r, ll p, T k)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span>(nl&gt;nr||nl&lt;<span class="hljs-number">1</span>||nr&gt;n) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// Here</span><br>		<span class="hljs-keyword">if</span> (nl&lt;=l&amp;&amp;r&lt;=nr) <span class="hljs-keyword">return</span> t[p]=(k==<span class="hljs-number">1</span>?r-l+<span class="hljs-number">1</span>:<span class="hljs-number">0</span>), tag[p]=k, <span class="hljs-built_in">void</span>();<br>		<span class="hljs-built_in">push_down</span>(p, l, r); ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (nl&lt;=mid) <span class="hljs-built_in">modify</span>(nl, nr, l, mid, ls, k);<br>		<span class="hljs-keyword">if</span> (nr&gt;mid) <span class="hljs-built_in">modify</span>(nl, nr, mid+<span class="hljs-number">1</span>, r, rs, k);<br>		<span class="hljs-built_in">push_up</span>(p);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll l, ll r, T k)</span> </span>&#123;<span class="hljs-built_in">modify</span>(l, r, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, k);&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(ll nl, ll nr, ll l, ll r, ll p)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (nl&lt;=l&amp;&amp;r&lt;=nr) <span class="hljs-keyword">return</span> t[p];<br>		<span class="hljs-built_in">push_down</span>(p, l, r); T res=<span class="hljs-number">0</span>; ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (nl&lt;=mid) res+=<span class="hljs-built_in">query</span>(nl, nr, l, mid, ls);<br>		<span class="hljs-keyword">if</span> (nr&gt;mid) res+=<span class="hljs-built_in">query</span>(nl, nr, mid+<span class="hljs-number">1</span>, r, rs);<br>		<span class="hljs-keyword">return</span> res;<br>	&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(ll l, ll r)</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(l, r, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);&#125;<br>&#125;;<br><br><span class="hljs-type">int</span> m, opt[N], ml[N], mr[N], q;<br><span class="hljs-type">int</span> l, r, mid, ans;<br>seg&lt;<span class="hljs-type">int</span>&gt; t;<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">chk</span><span class="hljs-params">()</span> </span>&#123;<br>	t.<span class="hljs-built_in">build</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=m; ++i) &#123;<br>		<span class="hljs-type">int</span> cnt=t.<span class="hljs-built_in">query</span>(ml[i], mr[i]);<br>		<span class="hljs-keyword">if</span> (opt[i]) &#123; <span class="hljs-comment">// ml[i]==mr[i] -&gt; range l&lt;r</span><br>			t.<span class="hljs-built_in">modify</span>(ml[i], ml[i]+cnt<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>); <span class="hljs-comment">// This Line</span><br>			t.<span class="hljs-built_in">modify</span>(ml[i]+cnt, mr[i], <span class="hljs-number">-1</span>);<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			t.<span class="hljs-built_in">modify</span>(ml[i], mr[i]-cnt, <span class="hljs-number">-1</span>);<br>			t.<span class="hljs-built_in">modify</span>(mr[i]-cnt+<span class="hljs-number">1</span>, mr[i], <span class="hljs-number">1</span>); <span class="hljs-comment">// This Line</span><br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> t.<span class="hljs-built_in">query</span>(q, q);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;e.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) a[i]=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=m; ++i) opt[i]=<span class="hljs-built_in">read</span>(), ml[i]=<span class="hljs-built_in">read</span>(), mr[i]=<span class="hljs-built_in">read</span>();<br>	q=<span class="hljs-built_in">read</span>(), l=<span class="hljs-number">1</span>, r=n;<br>	<span class="hljs-keyword">while</span> (l&lt;=r) &#123;<br>		mid=(l+r)&gt;&gt;<span class="hljs-number">1</span>, x=mid;<br>		<span class="hljs-keyword">if</span> (<span class="hljs-built_in">chk</span>()) ans=mid, l=mid+<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">else</span> r=mid<span class="hljs-number">-1</span>;<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, ans);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="T4-关注值域特点"><a href="#T4-关注值域特点" class="headerlink" title="T4 关注值域特点"></a>T4 关注值域特点</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P8969">洛谷P8969</a> 幻梦 | Dream with Dynamic</p>
<p>长度为 $n$ 的序列 $a_n$，维护区间加、区间变 $\text{popcount}$、单点查询。<br>区间变 $\text{popcount}$ 指的是对于 $\forall x\in[l,r]$，$a_i\leftarrow\operatorname{popcount}(a_i)$。</p>
<p>注意到区间加操作是可以合并的。也就是对于每一个数，合并后操作序列一定是这样 ($\text{add}$ 可能有也可能没有)：<br>$$<br>\text{add}\rightarrow\text{pcnt}\rightarrow\text{add}\rightarrow\text{pcnt}\rightarrow\text{add}\rightarrow\text{pcnt}\rightarrow\dots<br>$$</p>
<p>$\text{popcount}$ 操作的特点是进行之后值域变成 $O(\log V)$。则在线段树上维护加法标记和 $\text{popcount}$ 标记，第一次 $\text{popcount}$ 操作之后值域变成 $O(\log V)$，维护这些值经过之后操作的答案的函数。函数复合封闭，标记可以下传。时间复杂度 $O(n\log n\log V)$。(来自汪娟老师)</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173609137">AC</a> 156.14MB 8.69s</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-comment">// char buf[1&lt;&lt;20], *p1, *p2;</span><br><span class="hljs-comment">// #define getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 300010</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> V 64</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> pcnt __builtin_popcountll</span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">node</span> &#123;<br>	<span class="hljs-type">bool</span> flg;<br>	ll a, b; <span class="hljs-type">short</span> p[V];<br>	<span class="hljs-function">ll <span class="hljs-title">eval</span><span class="hljs-params">(ll x)</span> </span>&#123;<span class="hljs-keyword">return</span> flg?p[<span class="hljs-built_in">pcnt</span>(x+a)]+b:x+b;&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>&#123;flg=a=b=<span class="hljs-number">0</span>, <span class="hljs-built_in">memset</span>(p, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(p));&#125;<br>&#125;;<br><br><span class="hljs-type">void</span> <span class="hljs-keyword">operator</span>+=(node &amp;x, node y) &#123;<br>	<span class="hljs-keyword">if</span> (!y.flg) <span class="hljs-keyword">return</span> x.b+=y.b, <span class="hljs-built_in">void</span>();<br>	<span class="hljs-keyword">if</span> (!x.flg) <span class="hljs-keyword">return</span> y.a+=x.b, x=y, <span class="hljs-built_in">void</span>();<br>	<span class="hljs-comment">// vector&lt;int&gt; q(V);</span><br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;V; ++i) x.p[i]=y.p[<span class="hljs-built_in">pcnt</span>(x.p[i]+x.b+y.a)];<br>	<span class="hljs-comment">// for (int i=0; i&lt;V; ++i) x.p[i]=q[i];</span><br>	x.b=y.b;<br>&#125;<br><br>ll n, a[N];<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">struct</span> <span class="hljs-title class_">seg</span> &#123;<br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> ls (p&lt;&lt;1)</span><br>	<span class="hljs-meta">#<span class="hljs-keyword">define</span> rs (p&lt;&lt;1|1)</span><br>	ll t[N&lt;&lt;<span class="hljs-number">2</span>]; T tag[N&lt;&lt;<span class="hljs-number">2</span>];<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(ll p, ll l, ll r)</span> </span>&#123;<br>		tag[p]=<span class="hljs-number">0</span>; <span class="hljs-keyword">if</span> (l==r) <span class="hljs-keyword">return</span> t[p]=a[l], <span class="hljs-built_in">void</span>(); ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-built_in">build</span>(ls, l, mid), <span class="hljs-built_in">build</span>(rs, mid+<span class="hljs-number">1</span>, r);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n);&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push_down</span><span class="hljs-params">(ll p, ll l, ll r)</span> </span>&#123;<br>		tag[ls]+=tag[p], tag[rs]+=tag[p], tag[p].<span class="hljs-built_in">clear</span>();<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll nl, ll nr, ll l, ll r, ll p, T k)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (nl&lt;=l&amp;&amp;r&lt;=nr) <span class="hljs-keyword">return</span> tag[p]+=k, <span class="hljs-built_in">void</span>();<br>		<span class="hljs-built_in">push_down</span>(p, l, r); ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (nl&lt;=mid) <span class="hljs-built_in">modify</span>(nl, nr, l, mid, ls, k);<br>		<span class="hljs-keyword">if</span> (nr&gt;mid) <span class="hljs-built_in">modify</span>(nl, nr, mid+<span class="hljs-number">1</span>, r, rs, k);<br>	&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(ll l, ll r, T k)</span> </span>&#123;<span class="hljs-built_in">modify</span>(l, r, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>, k);&#125;<br>	<span class="hljs-function">ll <span class="hljs-title">query</span><span class="hljs-params">(ll x, ll l, ll r, ll p)</span> </span>&#123;<br>		<span class="hljs-keyword">if</span> (l==r) <span class="hljs-keyword">return</span> tag[p].<span class="hljs-built_in">eval</span>(a[x]);<br>		<span class="hljs-built_in">push_down</span>(p, l, r); ll mid=l+r&gt;&gt;<span class="hljs-number">1</span>;<br>		<span class="hljs-keyword">if</span> (x&lt;=mid) <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(x, l, mid, ls);<br>		<span class="hljs-keyword">if</span> (x&gt;mid) <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(x, mid+<span class="hljs-number">1</span>, r, rs);<br>	&#125;<br>	<span class="hljs-function">ll <span class="hljs-title">query</span><span class="hljs-params">(ll x)</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(x, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);&#125;<br>&#125;;<br><br><span class="hljs-type">int</span> q, l, r, x; <span class="hljs-type">char</span> ch;<br>seg&lt;node&gt; t;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;g.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), q=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) a[i]=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">while</span> (q--) &#123;<br>		ch=<span class="hljs-built_in">getchar</span>(); <span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;A&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;Z&#x27;</span>) ch=<span class="hljs-built_in">getchar</span>();<br>		<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;A&#x27;</span>) &#123;<br>			l=<span class="hljs-built_in">read</span>(), r=<span class="hljs-built_in">read</span>(), x=<span class="hljs-built_in">read</span>(); t.<span class="hljs-built_in">modify</span>(l, r, (node)&#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, x&#125;);<br>		&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;P&#x27;</span>) &#123;<br>			l=<span class="hljs-built_in">read</span>(), r=<span class="hljs-built_in">read</span>(); node nd=(node)&#123;<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>&#125;;<br>			<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;V; ++i) nd.p[i]=i; t.<span class="hljs-built_in">modify</span>(l, r, nd);<br>		&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;J&#x27;</span>) &#123;<br>			x=<span class="hljs-built_in">read</span>(), <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, t.<span class="hljs-built_in">query</span>(x));<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<hr>
<h3 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h3><h4 id="T1-Kruskal-针对相同边权的优化"><a href="#T1-Kruskal-针对相同边权的优化" class="headerlink" title="T1 Kruskal 针对相同边权的优化"></a>T1 Kruskal 针对相同边权的优化</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5687">洛谷P5687</a> [CSP-S2019 江西] 网格图</p>
<p>给出 $n\times m$ 的网格图。<br>点 $(i,j)$ 与点 $(i,j+1)$ 间的边权为 $a_i$，点 $(i,j)$ 与点 $(i+1,j)$ 之间的边权为 $b_i$。<br>求这个网格图的最小生成树。</p>
<p>考虑朴素的 Kruskal 最小生成树算法，边的量级在 $O(n^2)$，有大量相同权值的边在排序时处于连续位置。</p>
<p>突破点在于，只有 $n+m$ 条不同的边，所以只需要对这些边排序即可。步骤：</p>
<ol>
<li>将 $a$ 数组和 $b$ 数组分别升序排序，维护双指针 $i$、$j$ 分别指向 $a$、$b$ 数组。表示已取 $a_1\sim a_{i-1}$、$b_1\sim b_{j-1}$，待取 $a_i\sim a_n$、$b_j\sim b_m$。</li>
<li>$n1$ 表示 $a$ 中剩余边数，初始化为 $n$；$m1$ 同理。</li>
<li>找到 $a_i$ 与 $b_j$ 中较小的一者，将其加入最小生成树中。未保证无环，加入 $a_i$ 时需要加入 $m1$ 条边，而加入 $b_j$ 时需要加入 $n1$ 条边。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/175751577">AC</a> 6.00MB 396ms</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 300010</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> INF 0x7f7f7f7f7f7f7f7fLL</span><br>ll n, m, n1, m1, ans;<br>ll a[N], b[N];<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;a.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>(), n1=n<span class="hljs-number">-1</span>, m1=m<span class="hljs-number">-1</span>; <span class="hljs-comment">// &lt;-</span><br>	<span class="hljs-keyword">for</span> (ll i=<span class="hljs-number">1</span>; i&lt;=n; ++i) a[i]=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (ll i=<span class="hljs-number">1</span>; i&lt;=m; ++i) b[i]=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-built_in">sort</span>(a+<span class="hljs-number">1</span>, a+n+<span class="hljs-number">1</span>), <span class="hljs-built_in">sort</span>(b+<span class="hljs-number">1</span>, b+m+<span class="hljs-number">1</span>);<br>	ans=a[<span class="hljs-number">1</span>]*m1+b[<span class="hljs-number">1</span>]*n1; <span class="hljs-comment">// &lt;- Not Essential</span><br>	<span class="hljs-keyword">for</span> (ll i=<span class="hljs-number">2</span>, j=<span class="hljs-number">2</span>; i&lt;=n&amp;&amp;j&lt;=m; ) &#123;<br>		<span class="hljs-keyword">if</span> (a[i]&lt;b[j]) &#123;<br>			ans+=a[i]*m1;<br>			++i, --n1;<br>		&#125; <span class="hljs-keyword">else</span> &#123;<br>			ans+=b[j]*n1;<br>			++j, --m1;<br>		&#125;<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, ans);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="T2-分层图"><a href="#T2-分层图" class="headerlink" title="T2 分层图"></a>T2 分层图</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1073">洛谷P1073</a> [NOIP2009 提高组] 最优贸易</p>
<p>有向图，旅行家从 $1$ 出发到 $n$ 结束，路上选择一个城市买东西，再选择一个城市卖掉。<br>给出每个城市的售价，问最大利润。</p>
<p>典中典，建立分层图，共 $3$ 层。第 $1$ 层表示没有买，第 $2$ 层表示持有商品，第 $3$ 层表示已经卖完。<br>各层边权为 $0$，$1\rightarrow2$ 层设为各点售价的相反数，$2\rightarrow3$ 层设为各点售价。<br>从第 $1$ 层的 $1$ 号点开始，跑 SPFA 单源最长路。到第 $3$ 层的 $n$ 号点的最长路即为答案。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/175931700">AC</a> 13.58MB 146ms</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N0 100010</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> M0 500010</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 300010</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> M 3500010</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> INF 0x3f3f3f3f3f3f3f3fLL</span><br><span class="hljs-type">int</span> n, m;<br><span class="hljs-type">int</span> a[N0];<br><span class="hljs-type">int</span> t1, t2, t3;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> v e[i].to</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> w e[i].val</span><br><span class="hljs-type">int</span> head[N], tot;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">edge</span> &#123;<span class="hljs-type">int</span> to, nxt, val;&#125; e[M];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_edge</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, <span class="hljs-type">int</span> z)</span> </span>&#123;e[++tot]=&#123;y, head[x], z&#125;, head[x]=tot;&#125;<br><br>ll dis[N];<br>queue&lt;<span class="hljs-type">int</span>&gt; q; <span class="hljs-type">bool</span> inq[N];<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">spfa</span><span class="hljs-params">(<span class="hljs-type">int</span> s)</span> </span>&#123;<br>	<span class="hljs-comment">// memset(dis, 0, sizeof(dis));</span><br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;N; ++i) dis[i]=-INF;<br>	<span class="hljs-built_in">memset</span>(inq, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(inq));<br>	dis[s]=<span class="hljs-number">0</span>, q.<span class="hljs-built_in">push</span>(s), inq[s]=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>()) &#123;<br>		<span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>(); q.<span class="hljs-built_in">pop</span>(), inq[u]=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=head[u]; i; i=e[i].nxt) &#123;<br>			<span class="hljs-keyword">if</span> (dis[u]+w&lt;=dis[v]) <span class="hljs-keyword">continue</span>;<br>			dis[v]=dis[u]+w;<br>			<span class="hljs-keyword">if</span> (!inq[v]) q.<span class="hljs-built_in">push</span>(v), inq[v]=<span class="hljs-number">1</span>;<br>		&#125;<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;c.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) a[i]=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=m; ++i) &#123;<br>		t1=<span class="hljs-built_in">read</span>(), t2=<span class="hljs-built_in">read</span>(), t3=<span class="hljs-built_in">read</span>();<br>		<span class="hljs-built_in">add_edge</span>(t1, t2, <span class="hljs-number">0</span>), <span class="hljs-built_in">add_edge</span>(t1+n, t2+n, <span class="hljs-number">0</span>), <span class="hljs-built_in">add_edge</span>(t1+n+n, t2+n+n, <span class="hljs-number">0</span>);<br>		<span class="hljs-keyword">if</span> (t3!=<span class="hljs-number">2</span>) <span class="hljs-keyword">continue</span>;<br>		<span class="hljs-built_in">add_edge</span>(t2, t1, <span class="hljs-number">0</span>), <span class="hljs-built_in">add_edge</span>(t2+n, t1+n, <span class="hljs-number">0</span>), <span class="hljs-built_in">add_edge</span>(t2+n+n, t1+n+n, <span class="hljs-number">0</span>);<br>	&#125;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) <span class="hljs-built_in">add_edge</span>(i, i+n, -a[i]), <span class="hljs-built_in">add_edge</span>(i+n, i+n+n, a[i]);<br>	<span class="hljs-built_in">spfa</span>(<span class="hljs-number">1</span>);<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, dis[n+n+n]);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="T3-奇偶性问题"><a href="#T3-奇偶性问题" class="headerlink" title="T3 奇偶性问题"></a>T3 奇偶性问题</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5663">洛谷P5663</a> [CSP-J2019] 加工零件</p>
<p>题意较为复杂，请移步洛谷查看。</p>
<p>一开始还在想一个奇环控制奇偶，然后就一直被这个思路困住了，在第 $47\text{min}$ 才做出来。</p>
<h5 id="解法一-分奇偶的bfs"><a href="#解法一-分奇偶的bfs" class="headerlink" title="解法一 分奇偶的bfs"></a>解法一 分奇偶的bfs</h5><p>首先，将 $u\rightarrow1$ 的问题转化为 $1\rightarrow u$ 的问题，再从 $1$ 开始 BFS。<br>注意到答案只与距离的奇偶性有关。即，能否用奇数步&#x2F;偶数步在距离限制内从 $1$ 到达 $u$。<br>考虑分别记录奇数距离和偶数距离。奇数距离由偶数距离转移，偶数距离由奇数距离转移。具体实现见代码。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/176139140">AC</a> 4.98MB 153ms</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 100010</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> M 200010</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> INF 0x3f3f3f3f</span><br><span class="hljs-keyword">typedef</span> pair&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt; pii;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> mp make_pair</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span><br><span class="hljs-type">int</span> n, m, Q;<br><span class="hljs-type">int</span> t1, t2;<br><span class="hljs-type">int</span> ai, li;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> v e[i].to</span><br><span class="hljs-type">int</span> head[N], tot;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">edge</span> &#123;<span class="hljs-type">int</span> to, nxt;&#125; e[M];<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_edge</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> </span>&#123;e[++tot]=&#123;y, head[x]&#125;, head[x]=tot;&#125;<br><br>ll dis1[N], dis2[N];<br>queue&lt;<span class="hljs-type">int</span>&gt; q; <span class="hljs-type">bool</span> inq[N];<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">bfs</span><span class="hljs-params">(<span class="hljs-type">int</span> s)</span> </span>&#123;<br>	<span class="hljs-built_in">memset</span>(dis1, <span class="hljs-number">0x3f</span>, <span class="hljs-built_in">sizeof</span>(dis1));<br>	<span class="hljs-built_in">memset</span>(dis2, <span class="hljs-number">0x3f</span>, <span class="hljs-built_in">sizeof</span>(dis2));<br>	<span class="hljs-built_in">memset</span>(inq, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(inq));<br>	dis1[s]=<span class="hljs-number">0</span>, q.<span class="hljs-built_in">push</span>(s), inq[s]=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>()) &#123;<br>		<span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>(); q.<span class="hljs-built_in">pop</span>(), inq[u]=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=head[u]; i; i=e[i].nxt) &#123; <span class="hljs-comment">// Here ↓</span><br>			<span class="hljs-keyword">if</span> (dis1[u]+<span class="hljs-number">1</span>&lt;dis2[v]) &#123;<br>				dis2[v]=dis1[u]+<span class="hljs-number">1</span>;<br>				<span class="hljs-keyword">if</span> (!inq[v]) q.<span class="hljs-built_in">push</span>(v), inq[v]=<span class="hljs-number">1</span>;<br>			&#125;<br>			<span class="hljs-keyword">if</span> (dis2[u]+<span class="hljs-number">1</span>&lt;dis1[v]) &#123;<br>				dis1[v]=dis2[u]+<span class="hljs-number">1</span>;<br>				<span class="hljs-keyword">if</span> (!inq[v]) q.<span class="hljs-built_in">push</span>(v), inq[v]=<span class="hljs-number">1</span>;<br>			&#125;<br>		&#125;<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;a1.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>(), Q=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=m; ++i) t1=<span class="hljs-built_in">read</span>(), t2=<span class="hljs-built_in">read</span>(), <span class="hljs-built_in">add_edge</span>(t1, t2), <span class="hljs-built_in">add_edge</span>(t2, t1);<br>	<span class="hljs-built_in">bfs</span>(<span class="hljs-number">1</span>);<br>	<span class="hljs-comment">// for (int i=1; i&lt;=n; ++i) printf(&quot;%d &quot;, dis1[i]); puts(&quot;&quot;);</span><br>	<span class="hljs-comment">// for (int i=1; i&lt;=n; ++i) printf(&quot;%d &quot;, dis2[i]); puts(&quot;&quot;);</span><br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=Q; ++i) &#123;<br>		ai=<span class="hljs-built_in">read</span>(), li=<span class="hljs-built_in">read</span>();<br>		<span class="hljs-comment">// if (li&lt;dis1[ai]) &#123;puts(&quot;No&quot;); continue;&#125;</span><br>		<span class="hljs-keyword">if</span> (dis2[ai]&lt;=li&amp;&amp;li%<span class="hljs-number">2</span>==dis2[ai]%<span class="hljs-number">2</span>) &#123;<span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Yes&quot;</span>); <span class="hljs-keyword">continue</span>;&#125;<br>		<span class="hljs-keyword">if</span> (dis1[ai]&lt;=li&amp;&amp;li%<span class="hljs-number">2</span>==dis1[ai]%<span class="hljs-number">2</span>) &#123;<span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Yes&quot;</span>); <span class="hljs-keyword">continue</span>;&#125;<br>		<span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;No&quot;</span>);<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h5 id="解法二-分层图"><a href="#解法二-分层图" class="headerlink" title="解法二 分层图"></a>解法二 分层图</h5><p>$\texttt{jky}$ 在机房里讲的，奇数点和偶数点分别处于两层图中。<br>本质和上一算法近似，思路更直接。</p>
<hr>
<h3 id="简单题"><a href="#简单题" class="headerlink" title="简单题"></a>简单题</h3><h4 id="T1-考虑答案贡献"><a href="#T1-考虑答案贡献" class="headerlink" title="T1 考虑答案贡献"></a>T1 考虑答案贡献</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1403">洛谷P1403</a> [AHOI2005] 约数研究</p>
<p>设 $f(i)$ 表示 $i$ 的约数个数，求 $\sum\limits_{i&#x3D;1}^nf(i)$。</p>
<p>改变枚举顺序 + 整除分块优化。</p>
<p>首先，$i$ 的约数一定小于等于 $i$。对 $1$ 到 $n$ 进行枚举。<br>$[1,n]$ 中 $i$ 的倍数一共有 $\lfloor\frac ni\rfloor$ 个，而这些数都有共同的因数 $i$。<br>故答案为 $\sum\limits_{i&#x3D;1}^n\lfloor\frac ni\rfloor$。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173704250">AC</a> 3.96MB 106ms<br>代码过于简单，不展示。</p>
<h4 id="T2-进出数据结构要维护信息"><a href="#T2-进出数据结构要维护信息" class="headerlink" title="T2 进出数据结构要维护信息"></a>T2 进出数据结构要维护信息</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/B3602">洛谷B3602</a> [图论与代数结构 202] 最短路问题_2</p>
<p>写了 $+\infty$ 遍 SPFA 和一遍 Dijkstra。</p>
<p>SPFA <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173734121">TLE</a> 8.61MB 2.20s<br>Dijkstra <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173737025">AC</a> 4.38MB 5ms<br>代码过于简单，不展示。</p>
<p>SPFA 死亡原因：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>(); q.<span class="hljs-built_in">pop</span>(); <span class="hljs-comment">// 原来的代码</span><br><span class="hljs-type">int</span> u=q.<span class="hljs-built_in">front</span>(); q.<span class="hljs-built_in">pop</span>(), inq[u]=<span class="hljs-number">0</span>; <span class="hljs-comment">// 第五遍的正确TLE代码</span><br></code></pre></td></tr></table></figure>
<h4 id="T3-学会打表-1"><a href="#T3-学会打表-1" class="headerlink" title="T3 学会打表 1"></a>T3 学会打表 1</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P9930">洛谷P9930</a> [NFLSPC #6] 1064 病毒</p>
<p>对数字串 $x$，设其中奇数数码，偶数数码和总数码个数分别为 $a,b,c$。定义 $g(x)$ 为将奇数数字个数、偶数数字个数、数字总位数依次写下得到的数字串，不忽略前导零。</p>
<p>设 $f_k(x)$ 表示将数字 $x$ 忽略前导零写成数字串 $x’$ 后，将 $g(x’)$ 迭代 $k$ 次得到的数字串对应的数字，即设 $x^*&#x3D;g(g(\cdots g(x’)))$（共有 $k$ 个 $g$），则 $f_k(x)$ 为将 $x^*$ 写成数字后的结果。</p>
<p>给定 $n, k$，其中 $0\le n&lt;k\le10^5$，求 $\sum\limits_{i&#x3D;0}^{10^n-1} f_k(i)$。</p>
<p>打表发现 $k&#x3D;1$ 时答案为 $11$，其余情况答案为 $213\times10^n$。</p>
<p>证明过程见<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/article/7i6vvkud">题解</a></p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/173952308">AC</a> 564.00KB 7ms<br>代码过于简单，不展示。</p>
<h4 id="T4-学会打表-2"><a href="#T4-学会打表-2" class="headerlink" title="T4 学会打表 2"></a>T4 学会打表 2</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5657">洛谷P5657</a> [CSP-S2019] 格雷码</p>
<p>读题目。求 $n$ 位格雷码的 $k$ 号二进制串。</p>
<p>找规律即可，第 $i$ 位为 $k\oplus\lfloor\frac k2\rfloor$ 的第 $i$ 位。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/174736276">AC</a> 680.00KB 69ms<br>代码过于简单，不展示。</p>
<hr>
<h3 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h3><h4 id="T1-最大子段和"><a href="#T1-最大子段和" class="headerlink" title="T1 最大子段和"></a>T1 最大子段和</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1115">洛谷P1115</a> 最大子段和</p>
<p>给出一个长度为 $n$ 的序列 $a$，选出其中连续且非空的一段使得这段和最大。</p>
<h5 id="解法一-动态规划"><a href="#解法一-动态规划" class="headerlink" title="解法一 动态规划"></a>解法一 动态规划</h5><p>设 $f_i$ 表示以 $a_i$ 为结尾的最大子段和。则有转移方程：<br>$$<br>f_i&#x3D;max{f_{i-1}+a_i, a_i}<br>$$<br><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/175563308">AC</a> 4.48MB 30ms<br>代码过于简单，不展示。</p>
<h5 id="解法二-贪心"><a href="#解法二-贪心" class="headerlink" title="解法二 贪心"></a>解法二 贪心</h5><p>处理前缀和和前缀和前缀最小值，即：<br>$$<br>s_i&#x3D;s_{i-1}+a_i\\<br>ms_i&#x3D;\min_{j&#x3D;1}^is_j&#x3D;\min{ms_{i-1},s_i}<br>$$<br>这样，以 $i$ 为结尾的最大子段和即为 $s_i-ms_i$。<br>感性理解：前缀和 - 前缀和前缀最小值 &#x3D; 最大子段，因为前缀和是 $[1,j]$ 连续的。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/175570573">AC</a> 6.00MB 32ms<br>代码过于简单，不展示。</p>
<h4 id="T2-双子段和"><a href="#T2-双子段和" class="headerlink" title="T2 双子段和"></a>T2 双子段和</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2642">洛谷P2642</a> 双子序列最大和</p>
<p>取两段子段，使得子段和最大。子段最少包含 $1$ 个数，子段间最少间隔 $1$ 个数。</p>
<p>求 $[1,i]$ 最大子段和和 $[i,n]$ 最大子段和，分别记录到 $f1$ 和 $f2$ 上。最终答案即为 $\max\limits_{i&#x3D;2}^{n-1}f1_{i-1}+f2_{i+1}$。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/175565791">AC</a> 24.36MB 109ms<br>代码过于简单，不展示。</p>
<h4 id="T3-带最大长度限制的最大子段和"><a href="#T3-带最大长度限制的最大子段和" class="headerlink" title="T3 带最大长度限制的最大子段和"></a>T3 带最大长度限制的最大子段和</h4><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1714">洛谷P1714</a> 切蛋糕</p>
<p>最大长度为 $m$ 的最大子段和。</p>
<p>参考最大子段和的贪心解法，不同的是前缀最小和的下标取值范围有限制。使用单调队列维护 $ms_i&#x3D;\min\limits_{j&#x3D;i-m}^{i-1}s_j$。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/175626690">AC</a> 14.66MB 61ms<br>不知道怎么就写成 <code>ms[i-1]</code> 了？</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 500010</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> INF 0x7f7f7f7f7f7f7f7fLL</span><br>ll n, m, ans;<br>ll a[N], s[N], ms[N];<br><br>ll q[N], l, r; <span class="hljs-comment">// in range [l,r]</span><br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;a3.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), m=<span class="hljs-built_in">read</span>(), l=<span class="hljs-number">1</span>, r=<span class="hljs-number">0</span>, ans=-INF;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) a[i]=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) s[i]=a[i]+s[i<span class="hljs-number">-1</span>];<br>	<span class="hljs-comment">// for (int i=1; i&lt;=n; ++i) ms[i]=min(ms[i-1], s[i]);</span><br>	q[++r]=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) &#123;<br>		<span class="hljs-keyword">while</span> (l&lt;=r&amp;&amp;q[l]&lt;i-m) ++l;<br>		ms[i<span class="hljs-number">-1</span>]=s[q[l]];<br>		<span class="hljs-keyword">while</span> (l&lt;=r&amp;&amp;s[q[r]]&gt;=s[i]) --r;<br>		q[++r]=i;<br>	&#125;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) ans=<span class="hljs-built_in">max</span>(ans, s[i]-ms[i<span class="hljs-number">-1</span>]);<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, ans);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="T4-环形最大子段和"><a href="#T4-环形最大子段和" class="headerlink" title="T4 环形最大子段和"></a>T4 环形最大子段和</h4><p>没有源，环形最大子段和。<br>即，在最大子段和的基础上，认为 $a_1$ 和 $a_n$ 是连续的。</p>
<h5 id="解法一-断环为链"><a href="#解法一-断环为链" class="headerlink" title="解法一 断环为链"></a>解法一 断环为链</h5><p>线段树求最大子段和。</p>
<p>对环上 $n$ 个数复制一遍，再对这 $2n$ 个数建线段树。查询 $[1,n]$、$[2,n+1]$、$\dots$、$[n+1,2n]$ 区间的答案，取最大值即为最终答案。<br>时间复杂度 $O(n\log n)$。</p>
<h5 id="解法二-DP"><a href="#解法二-DP" class="headerlink" title="解法二 DP"></a>解法二 DP</h5><p>将环拆开，在 $1\sim n$ 的序列上进行操作。容易发现，最大子段只可能为以下两种情况：</p>
<ol>
<li>不经过断点 $n\rightarrow1$，答案区间 $[i,j]$；</li>
<li>经过断点 $n\rightarrow1$，答案区间 $[i,n]\cup[1,j]$。</li>
</ol>
<p>对于情况 $1$，直接在 $[1,n]$ 上做最大子段和即可。对于情况 $2$，可以在 $[1,n]$ 上做最小子段和，然后用整体减去最小子段和即可。</p>
<p>（我和 $\texttt{ltr}$ 看着表意模糊的题解想了半个多小时才想出来的，简直是无敌了）</p>
<h4 id="T5-带权最长上升子序列"><a href="#T5-带权最长上升子序列" class="headerlink" title="T5 带权最长上升子序列"></a>T5 带权最长上升子序列</h4><p><a target="_blank" rel="noopener" href="https://atcoder.jp/contests/dp/tasks/dp_q">AT_dp_q</a> Flowers | <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/AT_dp_q">洛谷</a></p>
<p>带权最长上升子序列。<br>序列长度为 $n$，每个点有高度 $h_i$ 和权值 $a_i$。从中选出高度递增且权值最大的子序列。</p>
<p>振声2025级信竞选拔考 第一轮T4<br>$\texttt{tmc}$ 告诉我的。实际上这道题我们统一刷过，但是我忘了。对于没能口糊 AK 下一级选拔考我感到很惭愧。</p>
<p>令 $f_i$ 表示以第 $i$ 个点为结尾的最长上升子序列，有状态转移方程：<br>$$<br>f_i&#x3D;a_i+\max_{j&#x3D;1}^{i-1}f_j[h_j&lt;h_i]<br>$$<br>使用树状数组维护即可。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/176480173">AC</a> 10.77MB 51ms</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;<br><br><span class="hljs-type">char</span> buf[<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">20</span>], *p1, *p2;<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> getchar() (p1==p2&amp;&amp;(p2=(p1=buf)+fread(buf,1,1&lt;&lt;20,stdin),p1==p2)?0:*p1++)</span><br><br><span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span> </span>&#123;<br>	ll x=<span class="hljs-number">0</span>, f=<span class="hljs-number">1</span>; <span class="hljs-type">char</span> ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">while</span> (ch&lt;<span class="hljs-string">&#x27;0&#x27;</span>||ch&gt;<span class="hljs-string">&#x27;9&#x27;</span>) &#123;<span class="hljs-keyword">if</span> (ch==<span class="hljs-string">&#x27;-&#x27;</span>) f=<span class="hljs-number">-1</span>; ch=<span class="hljs-built_in">getchar</span>();&#125;<br>	<span class="hljs-keyword">while</span> (ch&gt;=<span class="hljs-string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="hljs-string">&#x27;9&#x27;</span>) x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>), ch=<span class="hljs-built_in">getchar</span>();<br>	<span class="hljs-keyword">return</span> x*f;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> N 200010</span><br><span class="hljs-type">int</span> n, m;<br>ll ans;<br>ll a[N], d[N], w[N];<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">struct</span> <span class="hljs-title class_">BIT</span> &#123;<br>	T c[N]; <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>&#123;<span class="hljs-keyword">return</span> x&amp;(~x+<span class="hljs-number">1</span>);&#125;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">(<span class="hljs-type">int</span> x, T k)</span> </span>&#123;<span class="hljs-keyword">while</span> (x&lt;=n) c[x]=<span class="hljs-built_in">max</span>(c[x], k), x+=<span class="hljs-built_in">lowbit</span>(x);&#125;<br>	<span class="hljs-function">T <span class="hljs-title">g</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>&#123;T ans=<span class="hljs-built_in">T</span>(); <span class="hljs-keyword">while</span> (x&gt;<span class="hljs-number">0</span>) ans=<span class="hljs-built_in">max</span>(ans, c[x]), x-=<span class="hljs-built_in">lowbit</span>(x); <span class="hljs-keyword">return</span> ans;&#125;<br>	<span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">g</span>(x);&#125; <span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">g</span>(r)-<span class="hljs-built_in">g</span>(l<span class="hljs-number">-1</span>);&#125;<br>&#125;; BIT&lt;ll&gt; ta;<br><br><span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// freopen(&quot;a.in&quot;, &quot;r&quot;, stdin);</span><br>	n=<span class="hljs-built_in">read</span>(), ans=<span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) a[i]=d[i]=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) w[i]=<span class="hljs-built_in">read</span>();<br>	<span class="hljs-built_in">sort</span>(d+<span class="hljs-number">1</span>, d+n+<span class="hljs-number">1</span>), m=<span class="hljs-built_in">unique</span>(d+<span class="hljs-number">1</span>, d+n+<span class="hljs-number">1</span>)-d<span class="hljs-number">-1</span>;<br>	<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=n; ++i) &#123;<br>		<span class="hljs-type">int</span> p=<span class="hljs-built_in">lower_bound</span>(d+<span class="hljs-number">1</span>, d+m+<span class="hljs-number">1</span>, a[i])-d;<br>		ll t=ta.<span class="hljs-built_in">query</span>(p<span class="hljs-number">-1</span>)+w[i];<br>		ans=<span class="hljs-built_in">max</span>(ans, t);<br>		ta.<span class="hljs-built_in">modify</span>(p, t);<br>	&#125;<br>	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lld\n&quot;</span>, ans);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<hr>
<h3 id="写在后面"><a href="#写在后面" class="headerlink" title="写在后面"></a>写在后面</h3><p>44876 字符，<del>一点检查的欲望都没有</del>。发现问题记得写在<a href="../../errata">勘误表</a>上，谢谢！</p>
<!--这段时间看了一个很有意思的收支股票的题，关于 DP 状态设计的。$f$ 表示持有现金数量，$g$ 表示持有股票数量。最终状态只在 f 和 g 之间转移。记得总结一下！-->

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E7%AC%94%E8%AE%B0/" class="category-chain-item">笔记</a>
  
  
    <span>></span>
    
  <a href="/categories/%E7%AC%94%E8%AE%B0/%E7%AE%97%E6%B3%95/" class="category-chain-item">算法</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>刷题记录 24-08-19 至 24-09-10</div>
      <div>https://algo-x.cn/articles/Problem-Solving-Summary-Aug19-Sep10/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Taoran</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年9月13日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2024年9月16日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="SA - 相同方式共享">
                    <i class="iconfont icon-sa"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/articles/Offline-2D-Point-Counting-Algorithm/" title="离线二维数点算法">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">离线二维数点算法</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/articles/WordNet-Linux-Configuration-Guide/" title="WordNet Linux 配置指南">
                        <span class="hidden-mobile">WordNet Linux 配置指南</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <body>×</body> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
